/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ft=Object.create;var Be=Object.defineProperty;var Dt=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var Bt=Object.getPrototypeOf,zt=Object.prototype.hasOwnProperty;var Ut=(l,a)=>()=>(l&&(a=l(l=0)),a);var Kt=(l,a)=>()=>(a||l((a={exports:{}}).exports,a),a.exports),Wt=(l,a)=>{for(var t in a)Be(l,t,{get:a[t],enumerable:!0})},Et=(l,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of qt(a))!zt.call(l,i)&&i!==t&&Be(l,i,{get:()=>a[i],enumerable:!(e=Dt(a,i))||e.enumerable});return l};var Vt=(l,a,t)=>(t=l!=null?Ft(Bt(l)):{},Et(a||!l||!l.__esModule?Be(t,"default",{value:l,enumerable:!0}):t,l)),Jt=l=>Et(Be({},"__esModule",{value:!0}),l);function mt(l){var a=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;l=l.replace(a,function(e,i,r,s){return i+i+r+r+s+s});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function Yt(l,a,t){return Math.min(Math.max(l,a),t)}function me(l,a){return a.indexOf(l)>-1}var jt,f=Ut(()=>{jt=function(l,a){var t=document.querySelector("#"+l+" > .particles-js-canvas-el");this.pJS={canvas:{el:t,w:t.offsetWidth,h:t.offsetHeight},particles:{number:{value:400,density:{enable:!0,value_area:800}},color:{value:"#fff"},shape:{type:"circle",stroke:{width:0,color:"#ff0000"},polygon:{nb_sides:5},image:{src:"",width:100,height:100}},opacity:{value:1,random:!1,anim:{enable:!1,speed:2,opacity_min:0,sync:!1}},size:{value:20,random:!1,anim:{enable:!1,speed:20,size_min:0,sync:!1}},line_linked:{enable:!0,distance:100,color:"#fff",opacity:1,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:3e3,rotateY:3e3}},array:[]},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"grab"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:100,line_linked:{opacity:1}},bubble:{distance:200,size:80,duration:.4},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}},mouse:{}},retina_detect:!1,fn:{interact:{},modes:{},vendors:{}},tmp:{}};var e=this.pJS;a&&Object.deepExtend(e,a),e.tmp.obj={size_value:e.particles.size.value,size_anim_speed:e.particles.size.anim.speed,move_speed:e.particles.move.speed,line_linked_distance:e.particles.line_linked.distance,line_linked_width:e.particles.line_linked.width,mode_grab_distance:e.interactivity.modes.grab.distance,mode_bubble_distance:e.interactivity.modes.bubble.distance,mode_bubble_size:e.interactivity.modes.bubble.size,mode_repulse_distance:e.interactivity.modes.repulse.distance},e.fn.retinaInit=function(){e.retina_detect&&window.devicePixelRatio>1?(e.canvas.pxratio=window.devicePixelRatio,e.tmp.retina=!0):(e.canvas.pxratio=1,e.tmp.retina=!1),e.canvas.w=e.canvas.el.offsetWidth*e.canvas.pxratio,e.canvas.h=e.canvas.el.offsetHeight*e.canvas.pxratio,e.particles.size.value=e.tmp.obj.size_value*e.canvas.pxratio,e.particles.size.anim.speed=e.tmp.obj.size_anim_speed*e.canvas.pxratio,e.particles.move.speed=e.tmp.obj.move_speed*e.canvas.pxratio,e.particles.line_linked.distance=e.tmp.obj.line_linked_distance*e.canvas.pxratio,e.interactivity.modes.grab.distance=e.tmp.obj.mode_grab_distance*e.canvas.pxratio,e.interactivity.modes.bubble.distance=e.tmp.obj.mode_bubble_distance*e.canvas.pxratio,e.particles.line_linked.width=e.tmp.obj.line_linked_width*e.canvas.pxratio,e.interactivity.modes.bubble.size=e.tmp.obj.mode_bubble_size*e.canvas.pxratio,e.interactivity.modes.repulse.distance=e.tmp.obj.mode_repulse_distance*e.canvas.pxratio},e.fn.canvasInit=function(){e.canvas.ctx=e.canvas.el.getContext("2d")},e.fn.canvasSize=function(){e.canvas.el.width=e.canvas.w,e.canvas.el.height=e.canvas.h,e&&e.interactivity.events.resize&&window.addEventListener("resize",function(){e.canvas.w=e.canvas.el.offsetWidth,e.canvas.h=e.canvas.el.offsetHeight,e.tmp.retina&&(e.canvas.w*=e.canvas.pxratio,e.canvas.h*=e.canvas.pxratio),e.canvas.el.width=e.canvas.w,e.canvas.el.height=e.canvas.h,e.particles.move.enable||(e.fn.particlesEmpty(),e.fn.particlesCreate(),e.fn.particlesDraw(),e.fn.vendors.densityAutoParticles()),e.fn.vendors.densityAutoParticles()})},e.fn.canvasPaint=function(){e.canvas.ctx.fillRect(0,0,e.canvas.w,e.canvas.h)},e.fn.canvasClear=function(){e.canvas.ctx.clearRect(0,0,e.canvas.w,e.canvas.h)},e.fn.particle=function(i,r,s){if(this.radius=(e.particles.size.random?Math.random():1)*e.particles.size.value,e.particles.size.anim.enable&&(this.size_status=!1,this.vs=e.particles.size.anim.speed/100,e.particles.size.anim.sync||(this.vs=this.vs*Math.random())),this.x=s?s.x:Math.random()*e.canvas.w,this.y=s?s.y:Math.random()*e.canvas.h,this.x>e.canvas.w-this.radius*2?this.x=this.x-this.radius:this.x<this.radius*2&&(this.x=this.x+this.radius),this.y>e.canvas.h-this.radius*2?this.y=this.y-this.radius:this.y<this.radius*2&&(this.y=this.y+this.radius),e.particles.move.bounce&&e.fn.vendors.checkOverlap(this,s),this.color={},typeof i.value=="object")if(i.value instanceof Array){var n=i.value[Math.floor(Math.random()*e.particles.color.value.length)];this.color.rgb=mt(n)}else i.value.r!=null&&i.value.g!=null&&i.value.b!=null&&(this.color.rgb={r:i.value.r,g:i.value.g,b:i.value.b}),i.value.h!=null&&i.value.s!=null&&i.value.l!=null&&(this.color.hsl={h:i.value.h,s:i.value.s,l:i.value.l});else i.value=="random"?this.color.rgb={r:Math.floor(Math.random()*256)+0,g:Math.floor(Math.random()*256)+0,b:Math.floor(Math.random()*256)+0}:typeof i.value=="string"&&(this.color=i,this.color.rgb=mt(this.color.value));this.opacity=(e.particles.opacity.random?Math.random():1)*e.particles.opacity.value,e.particles.opacity.anim.enable&&(this.opacity_status=!1,this.vo=e.particles.opacity.anim.speed/100,e.particles.opacity.anim.sync||(this.vo=this.vo*Math.random()));var o={};switch(e.particles.move.direction){case"top":o={x:0,y:-1};break;case"top-right":o={x:.5,y:-.5};break;case"right":o={x:1,y:-0};break;case"bottom-right":o={x:.5,y:.5};break;case"bottom":o={x:0,y:1};break;case"bottom-left":o={x:-.5,y:1};break;case"left":o={x:-1,y:0};break;case"top-left":o={x:-.5,y:-.5};break;default:o={x:0,y:0};break}e.particles.move.straight?(this.vx=o.x,this.vy=o.y,e.particles.move.random&&(this.vx=this.vx*Math.random(),this.vy=this.vy*Math.random())):(this.vx=o.x+Math.random()-.5,this.vy=o.y+Math.random()-.5),this.vx_i=this.vx,this.vy_i=this.vy;var p=e.particles.shape.type;if(typeof p=="object"){if(p instanceof Array){var m=p[Math.floor(Math.random()*p.length)];this.shape=m}}else this.shape=p;if(this.shape=="image"){var P=e.particles.shape;this.img={src:P.image.src,ratio:P.image.width/P.image.height},this.img.ratio||(this.img.ratio=1),e.tmp.img_type=="svg"&&e.tmp.source_svg!=null&&(e.fn.vendors.createSvgImg(this),e.tmp.pushing&&(this.img.loaded=!1))}},e.fn.particle.prototype.draw=function(){var i=this;if(i.radius_bubble!=null)var r=i.radius_bubble;else var r=i.radius;if(i.opacity_bubble!=null)var s=i.opacity_bubble;else var s=i.opacity;if(i.color.rgb)var n="rgba("+i.color.rgb.r+","+i.color.rgb.g+","+i.color.rgb.b+","+s+")";else var n="hsla("+i.color.hsl.h+","+i.color.hsl.s+"%,"+i.color.hsl.l+"%,"+s+")";switch(e.canvas.ctx.fillStyle=n,e.canvas.ctx.beginPath(),i.shape){case"circle":e.canvas.ctx.arc(i.x,i.y,r,0,Math.PI*2,!1);break;case"edge":e.canvas.ctx.rect(i.x-r,i.y-r,r*2,r*2);break;case"triangle":e.fn.vendors.drawShape(e.canvas.ctx,i.x-r,i.y+r/1.66,r*2,3,2);break;case"polygon":e.fn.vendors.drawShape(e.canvas.ctx,i.x-r/(e.particles.shape.polygon.nb_sides/3.5),i.y-r/.76,r*2.66/(e.particles.shape.polygon.nb_sides/3),e.particles.shape.polygon.nb_sides,1);break;case"star":e.fn.vendors.drawShape(e.canvas.ctx,i.x-r*2/(e.particles.shape.polygon.nb_sides/4),i.y-r/1.52,r*2*2.66/(e.particles.shape.polygon.nb_sides/3),e.particles.shape.polygon.nb_sides,2);break;case"image":let m=function(){e.canvas.ctx.drawImage(o,i.x-r,i.y-r,r*2,r*2/i.img.ratio)};var p=m;if(e.tmp.img_type=="svg")var o=i.img.obj;else var o=e.tmp.img_obj;o&&m();break}e.canvas.ctx.closePath(),e.particles.shape.stroke.width>0&&(e.canvas.ctx.strokeStyle=e.particles.shape.stroke.color,e.canvas.ctx.lineWidth=e.particles.shape.stroke.width,e.canvas.ctx.stroke()),e.canvas.ctx.fill()},e.fn.particlesCreate=function(){for(var i=0;i<e.particles.number.value;i++)e.particles.array.push(new e.fn.particle(e.particles.color,e.particles.opacity.value))},e.fn.particlesUpdate=function(){for(var i=0;i<e.particles.array.length;i++){var r=e.particles.array[i];if(e.particles.move.enable){var s=e.particles.move.speed/2;r.x+=r.vx*s,r.y+=r.vy*s}if(e.particles.opacity.anim.enable&&(r.opacity_status==!0?(r.opacity>=e.particles.opacity.value&&(r.opacity_status=!1),r.opacity+=r.vo):(r.opacity<=e.particles.opacity.anim.opacity_min&&(r.opacity_status=!0),r.opacity-=r.vo),r.opacity<0&&(r.opacity=0)),e.particles.size.anim.enable&&(r.size_status==!0?(r.radius>=e.particles.size.value&&(r.size_status=!1),r.radius+=r.vs):(r.radius<=e.particles.size.anim.size_min&&(r.size_status=!0),r.radius-=r.vs),r.radius<0&&(r.radius=0)),e.particles.move.out_mode=="bounce")var n={x_left:r.radius,x_right:e.canvas.w,y_top:r.radius,y_bottom:e.canvas.h};else var n={x_left:-r.radius,x_right:e.canvas.w+r.radius,y_top:-r.radius,y_bottom:e.canvas.h+r.radius};switch(r.x-r.radius>e.canvas.w?(r.x=n.x_left,r.y=Math.random()*e.canvas.h):r.x+r.radius<0&&(r.x=n.x_right,r.y=Math.random()*e.canvas.h),r.y-r.radius>e.canvas.h?(r.y=n.y_top,r.x=Math.random()*e.canvas.w):r.y+r.radius<0&&(r.y=n.y_bottom,r.x=Math.random()*e.canvas.w),e.particles.move.out_mode){case"bounce":(r.x+r.radius>e.canvas.w||r.x-r.radius<0)&&(r.vx=-r.vx),(r.y+r.radius>e.canvas.h||r.y-r.radius<0)&&(r.vy=-r.vy);break}if(me("grab",e.interactivity.events.onhover.mode)&&e.fn.modes.grabParticle(r),(me("bubble",e.interactivity.events.onhover.mode)||me("bubble",e.interactivity.events.onclick.mode))&&e.fn.modes.bubbleParticle(r),(me("repulse",e.interactivity.events.onhover.mode)||me("repulse",e.interactivity.events.onclick.mode))&&e.fn.modes.repulseParticle(r),e.particles.line_linked.enable||e.particles.move.attract.enable)for(var o=i+1;o<e.particles.array.length;o++){var p=e.particles.array[o];e.particles.line_linked.enable&&e.fn.interact.linkParticles(r,p),e.particles.move.attract.enable&&e.fn.interact.attractParticles(r,p),e.particles.move.bounce&&e.fn.interact.bounceParticles(r,p)}}},e.fn.particlesDraw=function(){e.canvas.ctx.clearRect(0,0,e.canvas.w,e.canvas.h),e.fn.particlesUpdate();for(var i=0;i<e.particles.array.length;i++){var r=e.particles.array[i];r.draw()}},e.fn.particlesEmpty=function(){e.particles.array=[]},e.fn.particlesRefresh=function(){cancelRequestAnimFrame(e.fn.checkAnimFrame),cancelRequestAnimFrame(e.fn.drawAnimFrame),e.tmp.source_svg=void 0,e.tmp.img_obj=void 0,e.tmp.count_svg=0,e.fn.particlesEmpty(),e.fn.canvasClear(),e.fn.vendors.start()},e.fn.interact.linkParticles=function(i,r){var s=i.x-r.x,n=i.y-r.y,o=Math.sqrt(s*s+n*n);if(o<=e.particles.line_linked.distance){var p=e.particles.line_linked.opacity-o/(1/e.particles.line_linked.opacity)/e.particles.line_linked.distance;if(p>0){var m=e.particles.line_linked.color_rgb_line;e.canvas.ctx.strokeStyle="rgba("+m.r+","+m.g+","+m.b+","+p+")",e.canvas.ctx.lineWidth=e.particles.line_linked.width,e.canvas.ctx.beginPath(),e.canvas.ctx.moveTo(i.x,i.y),e.canvas.ctx.lineTo(r.x,r.y),e.canvas.ctx.stroke(),e.canvas.ctx.closePath()}}},e.fn.interact.attractParticles=function(i,r){var s=i.x-r.x,n=i.y-r.y,o=Math.sqrt(s*s+n*n);if(o<=e.particles.line_linked.distance){var p=s/(e.particles.move.attract.rotateX*1e3),m=n/(e.particles.move.attract.rotateY*1e3);i.vx-=p,i.vy-=m,r.vx+=p,r.vy+=m}},e.fn.interact.bounceParticles=function(i,r){var s=i.x-r.x,n=i.y-r.y,o=Math.sqrt(s*s+n*n),p=i.radius+r.radius;o<=p&&(i.vx=-i.vx,i.vy=-i.vy,r.vx=-r.vx,r.vy=-r.vy)},e.fn.modes.pushParticles=function(i,r){e.tmp.pushing=!0;for(var s=0;s<i;s++)e.particles.array.push(new e.fn.particle(e.particles.color,e.particles.opacity.value,{x:r?r.pos_x:Math.random()*e.canvas.w,y:r?r.pos_y:Math.random()*e.canvas.h})),s==i-1&&(e.particles.move.enable||e.fn.particlesDraw(),e.tmp.pushing=!1)},e.fn.modes.removeParticles=function(i){e.particles.array.splice(0,i),e.particles.move.enable||e.fn.particlesDraw()},e.fn.modes.bubbleParticle=function(i){if(e.interactivity.events.onhover.enable&&me("bubble",e.interactivity.events.onhover.mode)){let A=function(){i.opacity_bubble=i.opacity,i.radius_bubble=i.radius};var F=A,r=i.x-e.interactivity.mouse.pos_x,s=i.y-e.interactivity.mouse.pos_y,n=Math.sqrt(r*r+s*s),o=1-n/e.interactivity.modes.bubble.distance;if(n<=e.interactivity.modes.bubble.distance){if(o>=0&&e.interactivity.status=="mousemove"){if(e.interactivity.modes.bubble.size!=e.particles.size.value)if(e.interactivity.modes.bubble.size>e.particles.size.value){var p=i.radius+e.interactivity.modes.bubble.size*o;p>=0&&(i.radius_bubble=p)}else{var m=i.radius-e.interactivity.modes.bubble.size,p=i.radius-m*o;p>0?i.radius_bubble=p:i.radius_bubble=0}if(e.interactivity.modes.bubble.opacity!=e.particles.opacity.value)if(e.interactivity.modes.bubble.opacity>e.particles.opacity.value){var P=e.interactivity.modes.bubble.opacity*o;P>i.opacity&&P<=e.interactivity.modes.bubble.opacity&&(i.opacity_bubble=P)}else{var P=i.opacity-(e.particles.opacity.value-e.interactivity.modes.bubble.opacity)*o;P<i.opacity&&P>=e.interactivity.modes.bubble.opacity&&(i.opacity_bubble=P)}}}else A();e.interactivity.status=="mouseleave"&&A()}else if(e.interactivity.events.onclick.enable&&me("bubble",e.interactivity.events.onclick.mode)){let A=function(N,W,Pe,se,X){if(N!=W)if(e.tmp.bubble_duration_end){if(Pe!=null){var fe=se-E*(se-N)/e.interactivity.modes.bubble.duration,Ae=N-fe;B=N+Ae,X=="size"&&(i.radius_bubble=B),X=="opacity"&&(i.opacity_bubble=B)}}else if(n<=e.interactivity.modes.bubble.distance){if(Pe!=null)var oe=Pe;else var oe=se;if(oe!=N){var B=se-E*(se-N)/e.interactivity.modes.bubble.duration;X=="size"&&(i.radius_bubble=B),X=="opacity"&&(i.opacity_bubble=B)}}else X=="size"&&(i.radius_bubble=void 0),X=="opacity"&&(i.opacity_bubble=void 0)};var D=A;if(e.tmp.bubble_clicking){var r=i.x-e.interactivity.mouse.click_pos_x,s=i.y-e.interactivity.mouse.click_pos_y,n=Math.sqrt(r*r+s*s),E=(new Date().getTime()-e.interactivity.mouse.click_time)/1e3;E>e.interactivity.modes.bubble.duration&&(e.tmp.bubble_duration_end=!0),E>e.interactivity.modes.bubble.duration*2&&(e.tmp.bubble_clicking=!1,e.tmp.bubble_duration_end=!1)}e.tmp.bubble_clicking&&(A(e.interactivity.modes.bubble.size,e.particles.size.value,i.radius_bubble,i.radius,"size"),A(e.interactivity.modes.bubble.opacity,e.particles.opacity.value,i.opacity_bubble,i.opacity,"opacity"))}},e.fn.modes.repulseParticle=function(i){if(e.interactivity.events.onhover.enable&&me("repulse",e.interactivity.events.onhover.mode)&&e.interactivity.status=="mousemove"){var r=i.x-e.interactivity.mouse.pos_x,s=i.y-e.interactivity.mouse.pos_y,n=Math.sqrt(r*r+s*s),o={x:r/n,y:s/n},p=e.interactivity.modes.repulse.distance,m=100,P=Yt(1/p*(-1*Math.pow(n/p,2)+1)*p*m,0,50),E={x:i.x+o.x*P,y:i.y+o.y*P};e.particles.move.out_mode=="bounce"?(E.x-i.radius>0&&E.x+i.radius<e.canvas.w&&(i.x=E.x),E.y-i.radius>0&&E.y+i.radius<e.canvas.h&&(i.y=E.y)):(i.x=E.x,i.y=E.y)}else if(e.interactivity.events.onclick.enable&&me("repulse",e.interactivity.events.onclick.mode))if(e.tmp.repulse_finish||(e.tmp.repulse_count++,e.tmp.repulse_count==e.particles.array.length&&(e.tmp.repulse_finish=!0)),e.tmp.repulse_clicking){let se=function(){var X=Math.atan2(D,F);if(i.vx=N*Math.cos(X),i.vy=N*Math.sin(X),e.particles.move.out_mode=="bounce"){var oe={x:i.x+i.vx,y:i.y+i.vy};(oe.x+i.radius>e.canvas.w||oe.x-i.radius<0)&&(i.vx=-i.vx),(oe.y+i.radius>e.canvas.h||oe.y-i.radius<0)&&(i.vy=-i.vy)}};var W=se,p=Math.pow(e.interactivity.modes.repulse.distance/6,3),F=e.interactivity.mouse.click_pos_x-i.x,D=e.interactivity.mouse.click_pos_y-i.y,A=F*F+D*D,N=-p/A*1;A<=p&&se()}else e.tmp.repulse_clicking==!1&&(i.vx=i.vx_i,i.vy=i.vy_i)},e.fn.modes.grabParticle=function(i){if(e.interactivity.events.onhover.enable&&e.interactivity.status=="mousemove"){var r=i.x-e.interactivity.mouse.pos_x,s=i.y-e.interactivity.mouse.pos_y,n=Math.sqrt(r*r+s*s);if(n<=e.interactivity.modes.grab.distance){var o=e.interactivity.modes.grab.line_linked.opacity-n/(1/e.interactivity.modes.grab.line_linked.opacity)/e.interactivity.modes.grab.distance;if(o>0){var p=e.particles.line_linked.color_rgb_line;e.canvas.ctx.strokeStyle="rgba("+p.r+","+p.g+","+p.b+","+o+")",e.canvas.ctx.lineWidth=e.particles.line_linked.width,e.canvas.ctx.beginPath(),e.canvas.ctx.moveTo(i.x,i.y),e.canvas.ctx.lineTo(e.interactivity.mouse.pos_x,e.interactivity.mouse.pos_y),e.canvas.ctx.stroke(),e.canvas.ctx.closePath()}}}},e.fn.vendors.eventsListeners=function(){e.interactivity.detect_on=="window"?e.interactivity.el=window:e.interactivity.el=e.canvas.el,(e.interactivity.events.onhover.enable||e.interactivity.events.onclick.enable)&&(e.interactivity.el.addEventListener("mousemove",function(i){if(e.interactivity.el==window)var r=i.clientX,s=i.clientY;else var r=i.offsetX||i.clientX,s=i.offsetY||i.clientY;e.interactivity.mouse.pos_x=r,e.interactivity.mouse.pos_y=s,e.tmp.retina&&(e.interactivity.mouse.pos_x*=e.canvas.pxratio,e.interactivity.mouse.pos_y*=e.canvas.pxratio),e.interactivity.status="mousemove"}),e.interactivity.el.addEventListener("mouseleave",function(i){e.interactivity.mouse.pos_x=null,e.interactivity.mouse.pos_y=null,e.interactivity.status="mouseleave"})),e.interactivity.events.onclick.enable&&e.interactivity.el.addEventListener("click",function(){if(e.interactivity.mouse.click_pos_x=e.interactivity.mouse.pos_x,e.interactivity.mouse.click_pos_y=e.interactivity.mouse.pos_y,e.interactivity.mouse.click_time=new Date().getTime(),e.interactivity.events.onclick.enable)switch(e.interactivity.events.onclick.mode){case"push":e.particles.move.enable||e.interactivity.modes.push.particles_nb==1?e.fn.modes.pushParticles(e.interactivity.modes.push.particles_nb,e.interactivity.mouse):e.interactivity.modes.push.particles_nb>1&&e.fn.modes.pushParticles(e.interactivity.modes.push.particles_nb);break;case"remove":e.fn.modes.removeParticles(e.interactivity.modes.remove.particles_nb);break;case"bubble":e.tmp.bubble_clicking=!0;break;case"repulse":e.tmp.repulse_clicking=!0,e.tmp.repulse_count=0,e.tmp.repulse_finish=!1,setTimeout(function(){e.tmp.repulse_clicking=!1},e.interactivity.modes.repulse.duration*1e3);break}})},e.fn.vendors.densityAutoParticles=function(){if(e.particles.number.density.enable){var i=e.canvas.el.width*e.canvas.el.height/1e3;e.tmp.retina&&(i=i/(e.canvas.pxratio*2));var r=i*e.particles.number.value/e.particles.number.density.value_area,s=e.particles.array.length-r;s<0?e.fn.modes.pushParticles(Math.abs(s)):e.fn.modes.removeParticles(s)}},e.fn.vendors.checkOverlap=function(i,r){for(var s=0;s<e.particles.array.length;s++){var n=e.particles.array[s],o=i.x-n.x,p=i.y-n.y,m=Math.sqrt(o*o+p*p);m<=i.radius+n.radius&&(i.x=r?r.x:Math.random()*e.canvas.w,i.y=r?r.y:Math.random()*e.canvas.h,e.fn.vendors.checkOverlap(i))}},e.fn.vendors.createSvgImg=function(i){var r=e.tmp.source_svg,s=/#([0-9A-F]{3,6})/gi,n=r.replace(s,function(E,F,D,A){if(i.color.rgb)var N="rgba("+i.color.rgb.r+","+i.color.rgb.g+","+i.color.rgb.b+","+i.opacity+")";else var N="hsla("+i.color.hsl.h+","+i.color.hsl.s+"%,"+i.color.hsl.l+"%,"+i.opacity+")";return N}),o=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),p=window.URL||window.webkitURL||window,m=p.createObjectURL(o),P=new Image;P.addEventListener("load",function(){i.img.obj=P,i.img.loaded=!0,p.revokeObjectURL(m),e.tmp.count_svg++}),P.src=m},e.fn.vendors.destroypJS=function(){cancelAnimationFrame(e.fn.drawAnimFrame),t.remove(),pJSDom=null},e.fn.vendors.drawShape=function(i,r,s,n,o,p){var m=o*p,P=o/p,E=180*(P-2)/P,F=Math.PI-Math.PI*E/180;i.save(),i.beginPath(),i.translate(r,s),i.moveTo(0,0);for(var D=0;D<m;D++)i.lineTo(n,0),i.translate(n,0),i.rotate(F);i.fill(),i.restore()},e.fn.vendors.exportImg=function(){window.open(e.canvas.el.toDataURL("image/png"),"_blank")},e.fn.vendors.loadImg=function(i){if(e.tmp.img_error=void 0,e.particles.shape.image.src!="")if(i=="svg"){var r=new XMLHttpRequest;r.open("GET",e.particles.shape.image.src),r.onreadystatechange=function(n){r.readyState==4&&(r.status==200?(e.tmp.source_svg=n.currentTarget.response,e.fn.vendors.checkBeforeDraw()):(console.log("Error pJS - Image not found"),e.tmp.img_error=!0))},r.send()}else{var s=new Image;s.addEventListener("load",function(){e.tmp.img_obj=s,e.fn.vendors.checkBeforeDraw()}),s.src=e.particles.shape.image.src}else console.log("Error pJS - No image.src"),e.tmp.img_error=!0},e.fn.vendors.draw=function(){e.particles.shape.type=="image"?e.tmp.img_type=="svg"?e.tmp.count_svg>=e.particles.number.value?(e.fn.particlesDraw(),e.particles.move.enable?e.fn.drawAnimFrame=requestAnimFrame(e.fn.vendors.draw):cancelRequestAnimFrame(e.fn.drawAnimFrame)):e.tmp.img_error||(e.fn.drawAnimFrame=requestAnimFrame(e.fn.vendors.draw)):e.tmp.img_obj!=null?(e.fn.particlesDraw(),e.particles.move.enable?e.fn.drawAnimFrame=requestAnimFrame(e.fn.vendors.draw):cancelRequestAnimFrame(e.fn.drawAnimFrame)):e.tmp.img_error||(e.fn.drawAnimFrame=requestAnimFrame(e.fn.vendors.draw)):(e.fn.particlesDraw(),e.particles.move.enable?e.fn.drawAnimFrame=requestAnimFrame(e.fn.vendors.draw):cancelRequestAnimFrame(e.fn.drawAnimFrame))},e.fn.vendors.checkBeforeDraw=function(){e.particles.shape.type=="image"?e.tmp.img_type=="svg"&&e.tmp.source_svg==null?e.tmp.checkAnimFrame=requestAnimFrame(check):(cancelRequestAnimFrame(e.tmp.checkAnimFrame),e.tmp.img_error||(e.fn.vendors.init(),e.fn.vendors.draw())):(e.fn.vendors.init(),e.fn.vendors.draw())},e.fn.vendors.init=function(){e.fn.retinaInit(),e.fn.canvasInit(),e.fn.canvasSize(),e.fn.canvasPaint(),e.fn.particlesCreate(),e.fn.vendors.densityAutoParticles(),e.particles.line_linked.color_rgb_line=mt(e.particles.line_linked.color)},e.fn.vendors.start=function(){me("image",e.particles.shape.type)?(e.tmp.img_type=e.particles.shape.image.src.substr(e.particles.shape.image.src.length-3),e.fn.vendors.loadImg(e.tmp.img_type)):e.fn.vendors.checkBeforeDraw()},e.fn.vendors.eventsListeners(),e.fn.vendors.start()};Object.deepExtend=function(l,a){for(var t in a)a[t]&&a[t].constructor&&a[t].constructor===Object?(l[t]=l[t]||{},arguments.callee(l[t],a[t])):l[t]=a[t];return l};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(l){window.setTimeout(l,1e3/60)}}();window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}();window.pJSDom=[];window.particlesJS=function(l,a){typeof l!="string"&&(a=l,l="particles-js"),l||(l="particles-js");var t=document.getElementById(l),e="particles-js-canvas-el",i=t.getElementsByClassName(e);if(i.length)for(;i.length>0;)t.removeChild(i[0]);var r=document.createElement("canvas");r.className=e,r.style.width="100%",r.style.height="100%";var s=document.getElementById(l).appendChild(r);s!=null&&pJSDom.push(new jt(l,a))};window.particlesJS.load=function(l,a,t){var e=new XMLHttpRequest;e.open("GET",a),e.onreadystatechange=function(i){if(e.readyState==4)if(e.status==200){var r=JSON.parse(i.currentTarget.response);window.particlesJS(l,r),t&&t()}else console.log("Error pJS - XMLHttpRequest status: "+e.status),console.log("Error pJS - File config not found")},e.send()}});var St=Kt((xt,ze)=>{f();((l,a)=>{typeof define=="function"&&define.amd?define([],a):typeof ze=="object"&&ze.exports?ze.exports=a():l.fuzzysort=a()})(xt,l=>{"use strict";var a=(u,c)=>{if(!u||!c)return S;var h=F(u);ye(c)||(c=E(c));var y=h.bitflags;return(y&c._bitflags)!==y?S:A(h,c)},t=(u,c,h)=>{if(!u)return h!=null&&h.all?D(c,h):De;var y=F(u),w=y.bitflags,v=y.containsSpace,g=m((h==null?void 0:h.threshold)||0),x=(h==null?void 0:h.limit)||Fe,b=0,M=0,T=c.length;function ee(Me){b<x?(ke.add(Me),++b):(++M,Me._score>ke.peek()._score&&ke.replaceTop(Me))}if(h!=null&&h.key)for(var J=h.key,I=0;I<T;++I){var Y=c[I],L=Ne(Y,J);if(L&&(ye(L)||(L=E(L)),(w&L._bitflags)===w)){var H=A(y,L);H!==S&&(H._score<g||(H.obj=Y,ee(H)))}}else if(h!=null&&h.keys){var Ee=h.keys,ce=Ee.length;e:for(var I=0;I<T;++I){var Y=c[I];{for(var j=0,_=0;_<ce;++_){var J=Ee[_],L=Ne(Y,J);if(!L){Le[_]=q;continue}ye(L)||(L=E(L)),Le[_]=L,j|=L._bitflags}if((w&j)!==w)continue}if(v)for(let R=0;R<y.spaceSearches.length;R++)le[R]=Q;for(var _=0;_<ce;++_){if(L=Le[_],L===q){ve[_]=q;continue}if(ve[_]=A(y,L,!1,v),ve[_]===S){ve[_]=q;continue}if(v)for(let $=0;$<y.spaceSearches.length;$++){if(he[$]>-1e3&&le[$]>Q){var V=(le[$]+he[$])/4;V>le[$]&&(le[$]=V)}he[$]>le[$]&&(le[$]=he[$])}}if(v){for(let R=0;R<y.spaceSearches.length;R++)if(le[R]===Q)continue e}else{var k=!1;for(let R=0;R<ce;R++)if(ve[R]._score!==Q){k=!0;break}if(!k)continue}var ne=new n(ce);for(let R=0;R<ce;R++)ne[R]=ve[R];if(v){var U=0;for(let R=0;R<y.spaceSearches.length;R++)U+=le[R]}else{var U=Q;for(let $=0;$<ce;$++){var H=ne[$];if(H._score>-1e3&&U>Q){var V=(U+H._score)/4;V>U&&(U=V)}H._score>U&&(U=H._score)}}if(ne.obj=Y,ne._score=U,h!=null&&h.scoreFn){if(U=h.scoreFn(ne),!U)continue;U=m(U),ne._score=U}U<g||ee(ne)}}else for(var I=0;I<T;++I){var L=c[I];if(L&&(ye(L)||(L=E(L)),(w&L._bitflags)===w)){var H=A(y,L);H!==S&&(H._score<g||ee(H))}}if(b===0)return De;for(var xe=new Array(b),I=b-1;I>=0;--I)xe[I]=ke.poll();return xe.total=b+M,xe},e=(u,c="<b>",h="</b>")=>{for(var y=typeof c=="function"?c:void 0,w=u.target,v=w.length,g=u.indexes,x="",b=0,M=0,T=!1,ee=[],J=0;J<v;++J){var I=w[J];if(g[M]===J){if(++M,T||(T=!0,y?(ee.push(x),x=""):x+=c),M===g.length){y?(x+=I,ee.push(y(x,b++)),x="",ee.push(w.substr(J+1))):x+=I+h+w.substr(J+1);break}}else T&&(T=!1,y?(ee.push(y(x,b++)),x=""):x+=h);x+=I}return y?ee:x},i=u=>{typeof u=="number"?u=""+u:typeof u!="string"&&(u="");var c=W(u);return o(u,{_targetLower:c._lower,_targetLowerCodes:c.lowerCodes,_bitflags:c.bitflags})},r=()=>{X.clear(),oe.clear()};class s{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((c,h)=>c-h)}set indexes(c){return this._indexes=c}highlight(c,h){return e(this,c,h)}get score(){return p(this._score)}set score(c){this._score=m(c)}}class n extends Array{get score(){return p(this._score)}set score(c){this._score=m(c)}}var o=(u,c)=>{var y,w,v,g,x,b,M;let h=new s;return h.target=u,h.obj=(y=c.obj)!=null?y:S,h._score=(w=c._score)!=null?w:Q,h._indexes=(v=c._indexes)!=null?v:[],h._targetLower=(g=c._targetLower)!=null?g:"",h._targetLowerCodes=(x=c._targetLowerCodes)!=null?x:S,h._nextBeginningIndexes=(b=c._nextBeginningIndexes)!=null?b:S,h._bitflags=(M=c._bitflags)!=null?M:0,h},p=u=>u===Q?0:u>1?u:Math.E**(((-u+1)**.04307-1)*-2),m=u=>u===0?Q:u>1?u:1-Math.pow(Math.log(u)/-2+1,1/.04307),P=u=>{typeof u=="number"?u=""+u:typeof u!="string"&&(u=""),u=u.trim();var c=W(u),h=[];if(c.containsSpace){var y=u.split(/\s+/);y=[...new Set(y)];for(var w=0;w<y.length;w++)if(y[w]!==""){var v=W(y[w]);h.push({lowerCodes:v.lowerCodes,_lower:y[w].toLowerCase(),containsSpace:!1})}}return{lowerCodes:c.lowerCodes,_lower:c._lower,containsSpace:c.containsSpace,bitflags:c.bitflags,spaceSearches:h}},E=u=>{if(u.length>999)return i(u);var c=X.get(u);return c!==void 0||(c=i(u),X.set(u,c)),c},F=u=>{if(u.length>999)return P(u);var c=oe.get(u);return c!==void 0||(c=P(u),oe.set(u,c)),c},D=(u,c)=>{var h=[];h.total=u.length;var y=(c==null?void 0:c.limit)||Fe;if(c!=null&&c.key)for(var w=0;w<u.length;w++){var v=u[w],g=Ne(v,c.key);if(g!=S){ye(g)||(g=E(g));var x=o(g.target,{_score:g._score,obj:v});if(h.push(x),h.length>=y)return h}}else if(c!=null&&c.keys)for(var w=0;w<u.length;w++){for(var v=u[w],b=new n(c.keys.length),M=c.keys.length-1;M>=0;--M){var g=Ne(v,c.keys[M]);if(!g){b[M]=q;continue}ye(g)||(g=E(g)),g._score=Q,g._indexes.len=0,b[M]=g}if(b.obj=v,b._score=Q,h.push(b),h.length>=y)return h}else for(var w=0;w<u.length;w++){var g=u[w];if(g!=S&&(ye(g)||(g=E(g)),g._score=Q,g._indexes.len=0,h.push(g),h.length>=y))return h}return h},A=(u,c,h=!1,y=!1)=>{if(h===!1&&u.containsSpace)return N(u,c,y);for(var w=u._lower,v=u.lowerCodes,g=v[0],x=c._targetLowerCodes,b=v.length,M=x.length,I=0,T=0,ee=0;;){var J=g===x[T];if(J){if(B[ee++]=T,++I,I===b)break;g=v[I]}if(++T,T>=M)return S}var I=0,Y=!1,L=0,H=c._nextBeginningIndexes;H===S&&(H=c._nextBeginningIndexes=se(c.target)),T=B[0]===0?0:H[B[0]-1];var Ee=0;if(T!==M)for(;;)if(T>=M){if(I<=0||(++Ee,Ee>200))break;--I;var ce=fe[--L];T=H[ce]}else{var J=v[I]===x[T];if(J){if(fe[L++]=T,++I,I===b){Y=!0;break}++T}else T=H[T]}var j=b<=1?-1:c._targetLower.indexOf(w,B[0]),_=!!~j,V=_?j===0||c._nextBeginningIndexes[j-1]===j:!1;if(_&&!V){for(var k=0;k<H.length;k=H[k])if(!(k<=j)){for(var ne=0;ne<b&&v[ne]===c._targetLowerCodes[k+ne];ne++);if(ne===b){j=k,V=!0;break}}}var U=R=>{for(var $=0,Pt=0,we=1;we<b;++we)R[we]-R[we-1]!==1&&($-=R[we],++Pt);var $t=R[b-1]-R[0]-(b-1);if($-=(12+$t)*Pt,R[0]!==0&&($-=R[0]*R[0]*.2),!Y)$*=1e3;else{for(var ht=1,we=H[0];we<M;we=H[we])++ht;ht>24&&($*=(ht-24)*10)}return $-=(M-b)/2,_&&($/=1+b*b*1),V&&($/=1+b*b*1),$-=(M-b)/2,$};if(Y)if(V){for(var k=0;k<b;++k)B[k]=j+k;var xe=B,Me=U(B)}else var xe=fe,Me=U(fe);else{if(_)for(var k=0;k<b;++k)B[k]=j+k;var xe=B,Me=U(xe)}c._score=Me;for(var k=0;k<b;++k)c._indexes[k]=xe[k];c._indexes.len=b;let qe=new s;return qe.target=c.target,qe._score=c._score,qe._indexes=c._indexes,qe},N=(u,c,h)=>{for(var y=new Set,w=0,v=S,g=0,x=u.spaceSearches,b=x.length,M=0,T=()=>{for(let V=M-1;V>=0;V--)c._nextBeginningIndexes[Ae[V*2+0]]=Ae[V*2+1]},ee=!1,_=0;_<b;++_){he[_]=Q;var J=x[_];if(v=A(J,c),h){if(v===S)continue;ee=!0}else if(v===S)return T(),S;var I=_===b-1;if(!I){var Y=v._indexes,L=!0;for(let k=0;k<Y.len-1;k++)if(Y[k+1]-Y[k]!==1){L=!1;break}if(L){var H=Y[Y.len-1]+1,Ee=c._nextBeginningIndexes[H-1];for(let k=H-1;k>=0&&Ee===c._nextBeginningIndexes[k];k--)c._nextBeginningIndexes[k]=H,Ae[M*2+0]=k,Ae[M*2+1]=Ee,M++}}w+=v._score/b,he[_]=v._score/b,v._indexes[0]<g&&(w-=(g-v._indexes[0])*2),g=v._indexes[0];for(var ce=0;ce<v._indexes.len;++ce)y.add(v._indexes[ce])}if(h&&!ee)return S;T();var j=A(u,c,!0);if(j!==S&&j._score>w){if(h)for(var _=0;_<b;++_)he[_]=j._score/b;return j}h&&(v=c),v._score=w;var _=0;for(let V of y)v._indexes[_++]=V;return v._indexes.len=_,v},W=u=>{for(var c=u.length,h=u.toLowerCase(),y=[],w=0,v=!1,g=0;g<c;++g){var x=y[g]=h.charCodeAt(g);if(x===32){v=!0;continue}var b=x>=97&&x<=122?x-97:x>=48&&x<=57?26:x<=127?30:31;w|=1<<b}return{lowerCodes:y,bitflags:w,containsSpace:v,_lower:h}},Pe=u=>{for(var c=u.length,h=[],y=0,w=!1,v=!1,g=0;g<c;++g){var x=u.charCodeAt(g),b=x>=65&&x<=90,M=b||x>=97&&x<=122||x>=48&&x<=57,T=b&&!w||!v||!M;w=b,v=M,T&&(h[y++]=g)}return h},se=u=>{for(var c=u.length,h=Pe(u),y=[],w=h[0],v=0,g=0;g<c;++g)w>g?y[g]=w:(w=h[++v],y[g]=w===void 0?c:w);return y},X=new Map,oe=new Map,B=[],fe=[],Ae=[],le=[],he=[],Le=[],ve=[],Ne=(u,c)=>{var h=u[c];if(h!==void 0)return h;if(typeof c=="function")return c(u);var y=c;Array.isArray(c)||(y=c.split("."));for(var w=y.length,v=-1;u&&++v<w;)u=u[y[v]];return u},ye=u=>typeof u=="object"&&typeof u._bitflags=="number",Fe=1/0,Q=-Fe,De=[];De.total=0;var S=null,q=i(""),Z=u=>{var c=[],h=0,y={},w=v=>{for(var g=0,x=c[g],b=1;b<h;){var M=b+1;g=b,M<h&&c[M]._score<c[b]._score&&(g=M),c[g-1>>1]=c[g],b=1+(g<<1)}for(var T=g-1>>1;g>0&&x._score<c[T]._score;T=(g=T)-1>>1)c[g]=c[T];c[g]=x};return y.add=v=>{var g=h;c[h++]=v;for(var x=g-1>>1;g>0&&v._score<c[x]._score;x=(g=x)-1>>1)c[g]=c[x];c[g]=v},y.poll=v=>{if(h!==0){var g=c[0];return c[0]=c[--h],w(),g}},y.peek=v=>{if(h!==0)return c[0]},y.replaceTop=v=>{c[0]=v,w()},y},ke=Z();return{single:a,go:t,prepare:i,cleanup:r}})});var Qt={};Wt(Qt,{default:()=>ut});module.exports=Jt(Qt);f();var O=require("obsidian");f();var Te=require("obsidian");f();var He=require("obsidian"),kt=Vt(St());f();f();var Ce=require("obsidian"),Ue=class extends Ce.Modal{constructor(t,e,i,r,s){super(t);this.youtubeLinks=i,this.onRun=r,this.onSkip=s,this.youtubeProvider=e.youtubeProvider}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("mesh-modal"),t.createEl("h2",{text:"YouTube links detected"}),t.addClass("mesh-modal");let e=t.createEl("select");this.youtubeLinks.forEach(i=>{let r=e.createEl("option",{text:i});r.value=i}),new Ce.Setting(t).addButton(i=>{i.setButtonText("Run").setCta().onClick(async()=>{let r=e.value;if(r)try{let s=await this.youtubeProvider.getTranscript(r);this.onRun(s),this.close()}catch(s){new Ce.Notice(`Failed to fetch YouTube transcript: ${s.message}`),this.onSkip(),this.close()}else new Ce.Notice("Please select a YouTube link")})}).addButton(i=>{i.setButtonText("Skip").onClick(()=>{this.onSkip(),this.close()})})}onClose(){let{contentEl:t}=this;t.empty()}};f();var be=require("obsidian");async function At(l){let a=l.workspace.getActiveFile();if(a instanceof be.TFile)return await l.vault.read(a);throw new Error("No active note found")}async function pe(l,a,t){let e=l.settings.meshOutputFolder;if(!e)throw new Error("Mesh output folder not set");let i;typeof t=="string"?i=t.trim():i=t.value.trim(),i=i||"Mesh Note";let r=`${i}.md`,s=1;for(;await l.app.vault.adapter.exists(`${e}/${r}`);)r=`${i} (${s}).md`,s++;let n=`${e}/${r}`;await l.app.vault.create(n,a),new be.Notice(`File created: ${r}`);let o=l.app.vault.getAbstractFileByPath(n);o instanceof be.TFile&&await l.app.workspace.getLeaf(!1).openFile(o)}async function Ke(l,a){let t=l.app.workspace.getActiveViewOfType(be.MarkdownView);if(!t){new be.Notice("No active Markdown view found");return}let e=t.editor,i=e.getCursor();e.replaceRange(a,i),new be.Notice("Content inserted at cursor position")}f();async function gt(l,a,t){try{return await l.getProvider(a).generateResponse(t)}catch(e){throw d(l,`LLM Request failed: ${e}`),new Error(`LLM Request failed: ${e.message}`)}}f();var ft=`
Prompt:
<prompt>
{patternContents}
</prompt>

Input Data:
<input>
{input}
</input>

`,te="You are a helpful assistant. Follow the instructions provided within the XML tags to process the data accurately.The prompt data should never be included in the final response. Use Markdown formatting to enhance readability.The output should not be wrapped with a markdown code block.",We=`
To replicate this output consistently, follow these steps:

Extract Key Topics or Phrases:

Identify significant phrases, topics, or nouns from the original document that encapsulate the main ideas. These will serve as your "backlinks" and should be concise and meaningful.

Make the Backlinks Specific to the Document Topic: Ensure that the backlinks are specific enough to distinguish them from similar topics in other documents. For example, if the document is about "EPM Integration Agent for Oracle Cloud" and the topic is "Monitoring Agent," the backlink should be "EPM Integration Agent Monitoring" or "EPM Integration Agent - SSL Configuration" instead of just "Monitoring Agent" or "SSL Configuration."

Be sure to not include any duplicate backlinks or backlinks that already exist in the input document.

Check for Existing Files:

The content data you are acting upon will always have an XML tag called <files>. This tag contains a list of files.

Determine if any of these files correspond to the backlink topic. If a file or files can be used for the backlink topic, include the files in a new key called "potential links" for that item.

This helps to avoid creating new files unnecessarily by linking to existing files.

Compose a Question for Each Backlink:

Content: Write a question that can be asked to an internet-connected LLM about the backlink topic. The question should be clear, specific, and designed to elicit informative responses about the topic.
Determine the Exact Match:

For each backlink, find the exact word-for-word string in the original content that relates to it. This will be used in the "match" field to facilitate precise matching in your program.
Format in JSON:

Structure your output as a JSON array, ensuring each item contains the "backlink", "content", "match", and (if applicable) "potential links" keys. Never should be wrapped in a code block.
Example Structure:

[
  {
    "backlink": "Specific and Meaningful Topic Related to the Document",
    "content": "Your question about the backlink topic.",
    "match": "Exact word-for-word string from the original content.",
    "potential links": ["file1", "file2"]
  },
  // Additional items...
]

Guidelines:

Backlink:

Should be a concise phrase, topic, or noun.

Reflects the main idea for the corresponding content.

Make the Backlinks Specific to the Document Topic: Include context from the document to make the backlink unique and distinguishable from similar topics in other documents.

Avoid duplicates and topics already present in the input document.

Content:

Formulate a clear and specific question about the backlink topic.

The question should be suitable for an internet-connected LLM to answer, providing up-to-date information.

Match:

Use the exact word-for-word string from the original document.

Ensure accuracy to facilitate precise text matching in your program.

Potential Links (Optional):

If any files from the <files> tag correspond to the backlink topic, include their file names in the "potential links" key.

This helps to use existing files and avoid creating new ones unnecessarily.

IMPORTANT:

The output should be a JSON array. Never should be wrapped in a code block.
`;async function Oe(l,a,t,e){let i=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(?:embed\/)?(?:v\/)?(?:shorts\/)?(?:\S+)/g,r="";switch(t){case"active-note":case"clipboard":r=t==="active-note"?await At(l):await navigator.clipboard.readText();let s=Array.from(r.match(i)||[]);s&&s.length>0&&(r=await new Promise(n=>{new Ue(l,a,s,o=>{n(`YouTube Transcript:

${o}

Original Content:

${r}`)},()=>{n(r)}).open()}));break;case"tavily":if(e){d(a,"Searching Tavily for:",e.value),r=await a.tavilyProvider.search(e.value);break}else throw new Error("Tavily search input is required")}if(!r)throw new Error("No input content available");return vt(r)}function d(l,...a){l.settings.enableDebugging&&console.log(...a)}async function ie(l,a,t,e){d(l,"Processing patterns:",t);let i=e;for(let r of t){let s=await yt(l,r),n=vt(s),o=ft.replace("{patternContents}",n).replace("{input}",i);d(l,`Applying pattern: ${r}`),d(l,"Full prompt being sent to LLM:",o),i=await gt(l,a,o)}return i}async function re(l,a,t,e){d(l,"Processing stitched patterns:",t);let i="";for(let r of t){let s=await yt(l,r),n=vt(s),o=ft.replace("{patternContents}",n).replace("{input}",e),p=await gt(l,a,o);i+=`# ${r}

---

${p}


`}return i}function vt(l){return l.replace(/\*{10,}/g,"").replace(/!{10,}/g,"").replace(/\{patternContent\}/g,"").replace(/\{input\}/g,"")}async function yt(l,a){d(l,`Searching for pattern: ${a}`);async function t(i){let r=l.app.vault.getAbstractFileByPath(i);if(r instanceof He.TFolder){d(l,`Searching in folder: ${i}`);let s=r.children.filter(o=>o instanceof He.TFile);d(l,`Files in folder: ${s.map(o=>o.name).join(", ")}`);let n=s.find(o=>o.name===a);if(n||(n=s.find(o=>o.name===`${a}.md`)),n||(n=s.find(o=>o.name.toLowerCase()===a.toLowerCase())),n&&n instanceof He.TFile)return d(l,`Pattern found: ${n.path}`),n}else d(l,`Folder not found: ${i}`);return null}let e=await t(l.settings.customPatternsFolder);if(e||(e=await t(l.settings.fabricPatternsFolder)),e)return await l.app.vault.read(e);throw d(l,`Pattern '${a}' not found in custom or fabric patterns folders`),new Error(`Pattern '${a}' not found in custom or fabric patterns folders`)}async function Gt(l,a,t=10){let e=[...await l.loadCustomPatterns(),...await l.loadFabricPatterns()];return kt.go(a,e,{limit:t})}async function Se(l,a,t,e,i){if(t.empty(),a.length===0){t.addClass("hidden"),i([]);return}let r=await Gt(l,a);if(r.length>0){let s=[];r.forEach((n,o)=>{let p=t.createEl("div",{text:n.target,cls:"pattern-result"});p.addEventListener("click",()=>e(n.target)),s.push(p)}),t.removeClass("hidden"),i(s)}else t.addClass("hidden"),i([])}function ge(l,a,t,e,i){a.includes(l)||(a.push(l),t()),e(),i()}function ue(l,a,t,e){a.empty(),t.forEach(i=>{let r=Xt(i,s=>{let n=t.filter(o=>o!==s);l.addClass("hidden"),e(n),ue(l,a,n,e)});a.appendChild(r),l.removeClass("hidden")})}function Xt(l,a){let t=document.createElement("div");return t.textContent=l,t.className="selected-pattern",t.createEl("span",{text:"\xD7",cls:"remove-pattern"}).addEventListener("click",()=>a(l)),t}f();var Ve=class{constructor(a){this.containerEl=a}static createSelect(a,t,e){let i=(a instanceof HTMLElement,a).createEl("select",{cls:t});return e.forEach(r=>{i.createEl("option",{value:r,text:r})}),i}createUI(a,t){this.containerEl.empty(),this.containerEl.addClass("mesh-ai-container");let e=this.containerEl.createEl("h2",{text:"Mesh AI"}),i=this.createProviderSelect(a),r=this.createPromptInput();this.createSubmitButton().addEventListener("click",()=>{let o=i.value,p=r.value;p&&t(o,p)});let n=this.containerEl.createEl("div",{cls:"mesh-ai-response"});return{updateResponse:o=>{n.empty(),n.createEl("pre").setText(o)},showLoading:()=>{n.empty(),n.createEl("div",{text:"Processing...",cls:"mesh-ai-loading"})},hideLoading:()=>{n.empty()}}}createProviderSelect(a){let t=this.containerEl.createEl("div",{cls:"mesh-ai-select-container"});t.createEl("label",{text:"Select provider:",attr:{for:"mesh-ai-provider"}});let e=t.createEl("select",{cls:"mesh-ai-select",attr:{id:"mesh-ai-provider"}});return[{value:"openai",label:"OpenAI"},{value:"grocq",label:"Grocq"},{value:"ollama",label:"Ollama"},{value:"openrouter",label:"OpenRouter"},{value:"lmstudio",label:"LMStudio"}].forEach(r=>{let s=e.createEl("option",{value:r.value,text:r.label});this.isProviderConfigured(r.value,a)?s.disabled=!1:s.disabled=!0}),e}isProviderConfigured(a,t){return a==="ollama"?!!t.ollamaServerUrl:!!t[`${a}ApiKey`]}createPromptInput(){let a=this.containerEl.createEl("div",{cls:"mesh-ai-input-container"});return a.createEl("label",{text:"Enter your prompt:",attr:{for:"mesh-ai-prompt"}}),a.createEl("textarea",{cls:"mesh-ai-input",attr:{id:"mesh-ai-prompt",rows:"4"}})}createSubmitButton(){return this.containerEl.createEl("button",{cls:"mesh-ai-submit",text:"Submit"})}};f();var Mt=require("obsidian"),Je=class extends Mt.FuzzySuggestModal{constructor(t,e,i){super(t);this.models=e,this.onChoose=i}getItems(){return this.models}getItemText(t){return t}onChooseItem(t,e){this.onChoose(t)}};var _e="mesh-view",$e=class extends Te.ItemView{constructor(t,e){super(t);this.selectedPatterns=[];this.currentSelectedIndex=-1;this.patternResultElements=[];this.handleClickOutside=t=>{(!(t.target instanceof Node)||!this.patternResults.contains(t.target))&&this.patternResults.addClass("hidden")};this.plugin=e,this.patternStitchingEnabled=this.plugin.settings.patternStitchingEnabled,this.currentProvider=this.plugin.settings.selectedProvider}getViewType(){return _e}getDisplayText(){return"Mesh AI"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("mesh-view-container"),this.registerEvent(this.app.workspace.on("layout-change",this.onLayoutChange.bind(this))),this.registerEvent(this.app.workspace.on("resize",this.onLayoutChange.bind(this)));let e=t.createEl("div",{cls:"particles-js",attr:{id:"particles-js"}}),i=t.createEl("div",{cls:"mesh-form-container"});this.isProviderConfigured(this.plugin.settings.selectedProvider)||t.createEl("div",{cls:"mesh-overlay"}).createEl("p",{text:"The default provider selected is not configured."});let s={openai:"openai",ollama:"ollama",openrouter:"openrouter",grocq:"grocq",lmstudio:"lmstudio"},n=this.createCard(i,"provider"),o=Ve.createSelect(n,"mesh-provider-select",Object.values(s));o.value=this.currentProvider;let m=n.createEl("div",{cls:"mesh-model-container"}).createEl("p",{cls:"mesh-model-text"}),P=m.createEl("span",{text:"powered by ",cls:"mesh-powered-by"});this.modelNameSpan=m.createEl("span",{cls:"mesh-model-name"});let E=m.createEl("span",{cls:"mesh-model-edit-icon",text:"\u270F\uFE0F"}),F=S=>{let q=this.modelNameSpan.querySelector(".mesh-model-name-old")||this.modelNameSpan.cloneNode(!0),Z=this.modelNameSpan.querySelector(".mesh-model-name-new")||this.modelNameSpan.cloneNode(!0);q.textContent=this.modelNameSpan.textContent,Z.textContent=S,q.classList.add("mesh-model-name-old"),Z.classList.add("mesh-model-name-new"),this.modelNameSpan.innerHTML="",this.modelNameSpan.appendChild(q),this.modelNameSpan.appendChild(Z),this.modelNameSpan.offsetWidth,this.modelNameSpan.classList.add("changing"),setTimeout(()=>{this.modelNameSpan.classList.remove("changing"),this.modelNameSpan.textContent=S},600)},D=async()=>{let q=await this.plugin.getProvider(this.currentProvider).getAvailableModels(),Z=this.plugin.settings.providerModels[this.currentProvider][0]||q[0];F(Z)};await D();let A=()=>{this.plugin.getProvider(this.currentProvider).getAvailableModels().then(q=>{new Je(this.app,q,Z=>{this.plugin.settings.providerModels[this.currentProvider]=[Z],this.plugin.saveSettings(),F(Z)}).open()})};this.modelNameSpan.addEventListener("click",A),E.addEventListener("click",A),o.addEventListener("change",async S=>{this.currentProvider=S.target.value,await D()});let N=this.createCard(i,"Input"),W=N.createEl("div",{cls:"input-toggle-container"}),Pe=W.createEl("div",{cls:"input-toggle-slider mesh-slider"});[{value:"active-note",text:"Note",icon:"\u{1F4DD}"},{value:"clipboard",text:"Clipboard",icon:"\u{1F4CB}"},{value:this.plugin.settings.usePerplexity?"perplexity":"tavily",text:this.plugin.settings.usePerplexity?"Perplexity":"Tavily",icon:"\u{1F50D}"}].forEach((S,q)=>{let Z=W.createEl("label",{cls:"input-toggle-label"}),ke=Z.createEl("input",{attr:{type:"radio",name:"input-source",value:S.value},cls:"input-toggle-input"});S.value==="note"&&(ke.checked=!0),Z.createEl("span",{text:S.text,cls:"input-toggle-text"}),Z.createEl("span",{text:S.icon,cls:"input-toggle-icon"}),ke.addEventListener("change",()=>{this.handleInputSourceChange(S.value,q)})});let oe=N.createEl("div",{cls:"tavily-search-container"}).createEl("input",{attr:{type:"text",placeholder:this.plugin.settings.usePerplexity?"Enter Perplexity search query":"Enter Tavily search query"},cls:"mesh-tavily-input tavily-hidden"}),B=this.createCard(i,"patterns"),fe=B.createEl("div",{cls:"pattern-search-container"});this.patternInput=new Te.TextComponent(fe).setPlaceholder("Search patterns...").onChange(S=>{Se(this.plugin,S,this.patternResults,this.handlePatternSelect.bind(this),q=>{this.patternResultElements=q,this.currentSelectedIndex=q.length>0?0:-1,this.highlightCurrentResult()})}),this.patternResults=fe.createEl("div",{cls:"pattern-results"}),this.patternInput.inputEl.addClass("pattern-search-input"),this.patternInput.inputEl.addEventListener("keydown",this.handlePatternInputKeydown.bind(this)),B.createEl("h4",{text:"Selected patterns",cls:"mesh-selected-patterns-title"}).addClass("hidden"),this.selectedPatternsContainer=B.createEl("div",{cls:"selected-patterns-container"});let le=B.createEl("div",{cls:"pattern-stitching-container"}),he=le.createEl("label",{cls:"switch"}),Le=he.createEl("input",{type:"checkbox",cls:"pattern-stitching-input"});Le.checked=this.patternStitchingEnabled;let ve=he.createEl("span",{cls:"mesh-slider round"}),Ne=le.createEl("span",{text:"Pattern stitching",cls:"pattern-stitching-label"});Le.addEventListener("change",S=>{this.patternStitchingEnabled=S.target.checked,this.plugin.settings.patternStitchingEnabled=this.patternStitchingEnabled,this.plugin.saveSettings();let q=this.patternStitchingEnabled?"enabled":"disabled";q==="enabled"?ve.addClass("stitching-enabled"):ve.removeClass("stitching-enabled"),new Te.Notice(`Pattern Stitching ${q}.`)});let ye=this.createCard(i,"output");this.outputFileNameInput=ye.createEl("input",{type:"text",placeholder:"Output file name (optional)",cls:"mesh-output-filename-input"}),i.createEl("div",{cls:"mesh-submit-button-container"}).createEl("button",{text:"Submit",cls:"mesh-submit-button"}).addEventListener("click",this.onSubmit.bind(this)),this.loadingElement=t.createEl("div",{text:"Processing...",cls:"mesh-loading"}),this.loadingElement.hide(),setTimeout(()=>this.initParticles(),100),document.addEventListener("click",this.handleClickOutside),setTimeout(()=>{t.addClass("loaded")},100),this.registerInterval(window.setInterval(()=>{let S=this.containerEl.offsetWidth;this.adjustLayoutForWidth(S)},100)),this.isProviderConfigured(this.plugin.settings.selectedProvider)?d(this.plugin,"Provider configured"):(d(this.plugin,"Provider not configured"),t.createEl("div",{cls:"mesh-overlay"}).createEl("p",{text:"The default provider selected is not configured."}))}initParticles(){let t=this.containerEl.children[1],e=t.querySelector("#particles-js");e||(e=t.createEl("div",{cls:"particles-js",attr:{id:"particles-js"}}));let i=()=>{typeof window.pJSDom!="undefined"&&window.pJSDom.length>0&&(window.pJSDom[0].pJS.fn.vendors.destroypJS(),window.pJSDom=[])},r=()=>{if(typeof window.particlesJS=="function"&&e.clientWidth>0&&e.clientHeight>0){i();try{window.particlesJS("particles-js",{particles:{number:{value:120,density:{enable:!0,value_area:1e3}},color:{value:["#81a0ed","#694daa","#9c27b0","#3f51b5"]},shape:{type:["circle","triangle"],polygon:{nb_sides:5}},opacity:{value:.5,random:!0,anim:{enable:!0,speed:.8,opacity_min:.1,sync:!1}},size:{value:3,random:!0,anim:{enable:!0,speed:1.5,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:200,color:"#81a0ed",opacity:.3,width:1},move:{enable:!0,speed:1.5,direction:"none",random:!0,straight:!1,out_mode:"bounce",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"grab"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:150,line_linked:{opacity:.5}},push:{particles_nb:3}}},retina_detect:!0})}catch(n){console.error("Error initializing particles:",n)}}};r();let s=new ResizeObserver(this.debounce(()=>{let n=e.querySelector("canvas");n&&(n.width=e.clientWidth,n.height=e.clientHeight),r()},200));return s.observe(t),()=>{s.disconnect(),i()}}debounce(t,e){let i=null;return(...r)=>{i&&clearTimeout(i),i=setTimeout(()=>t(...r),e)}}createCard(t,e){let i=t.createEl("div",{cls:`mesh-card ${e.toLowerCase()}`});return i.createEl("h3",{text:e,cls:"mesh-card-title"}),i}updateTheme(){let t=document.body.classList.contains("theme-dark");this.containerEl.toggleClass("theme-dark",t),this.containerEl.toggleClass("theme-light",!t)}async onSubmit(){d(this.plugin,"onSubmit method called");let t=this.containerEl.querySelector('input[name="input-source"]:checked'),e=this.containerEl.querySelector(".mesh-tavily-input"),i=this.currentProvider,r=t?t.value:"active-note",s=this.selectedPatterns;try{await this.showLoading(),this.startRotating(this.providerCard),await new Promise(p=>setTimeout(p,2e3)),this.stopRotating(this.providerCard),this.startRotating(this.inputCard),await new Promise(p=>setTimeout(p,2e3)),d(this.plugin,"Getting input content...");let n;r==="tavily"||r==="perplexity"?n=await this.getSearchProviderContent(r,e.value):n=await Oe(this.app,this.plugin,r,e),this.stopRotating(this.inputCard),this.startRotating(this.patternsCard),await new Promise(p=>setTimeout(p,2e3)),d(this.plugin,"Processing patterns...");let o;this.patternStitchingEnabled?o=await re(this.plugin,i,s,n):o=await ie(this.plugin,i,s,n),this.stopRotating(this.patternsCard),this.startRotating(this.outputCard),await new Promise(p=>setTimeout(p,2e3)),d(this.plugin,"Creating output file..."),await pe(this.plugin,o,this.outputFileNameInput),this.stopRotating(this.outputCard)}catch(n){console.error("Error processing request:",n),new Te.Notice(`Error: ${n instanceof Error?n.message:String(n)}`)}finally{this.hideLoading()}}async getSearchProviderContent(t,e){let i=this.plugin.getSearchProvider(t);if("search"in i)return await i.search(e);throw new Error(`Provider ${t} does not support search method`)}async showLoading(){let t=this.containerEl.querySelector(".mesh-form-container"),e=Array.from(t.querySelectorAll(".mesh-card")),i=this.containerEl.querySelector(".mesh-submit-button-container"),r=i.querySelector(".mesh-submit-button");this.providerCard=e[0],this.inputCard=e[1],this.patternsCard=e[2],this.outputCard=e[3],this.startRotating=s=>{s.classList.add("rotating")},this.stopRotating=s=>{s.classList.remove("rotating")},i.classList.add("processing"),r.classList.add("processing"),r.disabled=!0,r.textContent="Processing..."}hideLoading(){let t=this.containerEl.querySelector(".mesh-form-container"),e=Array.from(t.querySelectorAll(".mesh-card")),i=this.containerEl.querySelector(".mesh-submit-button-container"),r=i.querySelector(".mesh-submit-button");e.forEach(s=>{s.classList.remove("rotating")}),i.classList.remove("processing"),r.classList.remove("processing"),r.disabled=!1,r.textContent="Submit"}handleInputSourceChange(t,e){let i=this.containerEl.querySelector(".mesh-tavily-input");this.containerEl.querySelector(".input-toggle-slider").setAttribute("data-position",e.toString()),t==="tavily"||t==="perplexity"?(i.classList.remove("tavily-hidden"),i.placeholder=this.plugin.settings.usePerplexity?"Enter Perplexity search query":"Enter Tavily search query"):i.classList.add("tavily-hidden")}handlePatternInputKeydown(t){(t.key==="ArrowDown"||t.key==="ArrowUp"||t.key==="Enter")&&(t.preventDefault(),t.key==="ArrowDown"?this.navigatePatternResults(1):t.key==="ArrowUp"?this.navigatePatternResults(-1):t.key==="Enter"&&this.selectCurrentPattern())}navigatePatternResults(t){let e=this.patternResultElements.length;e!==0&&(this.currentSelectedIndex=(this.currentSelectedIndex+t+e)%e,this.highlightCurrentResult())}highlightCurrentResult(){this.patternResultElements.forEach((t,e)=>{t.classList.toggle("selected",e===this.currentSelectedIndex)})}selectCurrentPattern(){var t;if(this.currentSelectedIndex>=0&&this.currentSelectedIndex<this.patternResultElements.length){let i=((t=this.patternResultElements[this.currentSelectedIndex].textContent)==null?void 0:t.trim())||"";this.handlePatternSelect(i)}}handlePatternSelect(t){ge(t,this.selectedPatterns,()=>ue(this.containerEl.querySelector(".mesh-selected-patterns-title"),this.selectedPatternsContainer,this.selectedPatterns,e=>{this.selectedPatterns=e}),()=>this.patternInput.setValue(""),()=>{this.patternResults.empty(),this.patternResultElements=[],this.currentSelectedIndex=-1})}onLayoutChange(){this.initParticles()}setupResizeObserver(){new ResizeObserver(e=>{for(let i of e){let r=i.contentRect.width;this.adjustLayoutForWidth(r)}}).observe(this.containerEl)}adjustLayoutForWidth(t){let e=this.containerEl.querySelector(".mesh-view-container"),i=Array.from(e.querySelectorAll(".mesh-card")),r=Array.from(this.containerEl.querySelectorAll(".input-toggle-label"));t<409?r.forEach(s=>{let n=s.querySelector(".input-toggle-text"),o=s.querySelector(".input-toggle-icon");n&&o&&(n.style.display="none",o.style.display="inline")}):r.forEach(s=>{let n=s.querySelector(".input-toggle-text"),o=s.querySelector(".input-toggle-icon");n&&o&&(n.style.display="inline",o.style.display="none")})}async onClose(){let t=this.initParticles();this.setupResizeObserver(),t(),document.removeEventListener("click",this.handleClickOutside)}isProviderConfigured(t){let e=t==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${t}ApiKey`],i=this.plugin.settings.providerModels[t];return!!e&&i.length>0}};f();var C=require("obsidian");var je=class extends C.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}async display(){let{containerEl:t}=this;t.empty();let e=["openai","google","microsoft","anthropic","grocq","openrouter","ollama","lmstudio"],i=["openai","grocq","ollama","openrouter","lmstudio"];for(let n of e){let o=t.createEl("div",{cls:"mesh-provider-container"});o.createEl("h3",{text:n.charAt(0).toUpperCase()+n.slice(1)}),i.includes(n)||o.createEl("div",{cls:"mesh-overlay"}).createEl("p",{text:"Coming soon"}),n==="ollama"?new C.Setting(o).setName("Ollama server URL").setDesc("Enter the URL for your Ollama server").addText(m=>m.setPlaceholder("Enter URL").setValue(this.plugin.settings.ollamaServerUrl).onChange(async P=>{this.plugin.settings.ollamaServerUrl=P,await this.plugin.saveSettings()})):n==="microsoft"?(new C.Setting(o).setName("Microsoft Azure API key").setDesc("Enter your Microsoft Azure API key").addText(m=>m.setPlaceholder("Enter API key").setValue(this.plugin.settings.microsoftApiKey).onChange(async P=>{this.plugin.settings.microsoftApiKey=P,await this.plugin.saveSettings()})),new C.Setting(o).setName("Microsoft Azure Endpoint URL").setDesc("Enter your Microsoft Azure Endpoint URL").addText(m=>m.setPlaceholder("Enter Endpoint URL").setValue(this.plugin.settings.microsoftEndpointUrl||"").onChange(async P=>{this.plugin.settings.microsoftEndpointUrl=P,await this.plugin.saveSettings()}))):n==="lmstudio"?new C.Setting(o).setName("LMStudio server URL").setDesc("Enter the URL for your LMStudio server").addText(m=>m.setPlaceholder("Enter URL").setValue(this.plugin.settings.lmstudioServerUrl).onChange(async P=>{this.plugin.settings.lmstudioServerUrl=P,await this.plugin.saveSettings()})):new C.Setting(o).setName("API key").setDesc(`Enter your ${n} API key`).addText(m=>m.setPlaceholder("Enter API key").setValue(this.plugin.settings[`${n}ApiKey`]).onChange(async P=>{this.plugin.settings[`${n}ApiKey`]=P,await this.plugin.saveSettings()})).addButton(m=>m.setButtonText("Test API Key").onClick(async()=>{await this.testApiKey(n)}));let p=new C.Setting(o).setName("Model").setDesc(`Select the model for ${n}`).addDropdown(async m=>{await this.populateModelDropdown(m,n)});p.addButton(m=>{m.setButtonText("Refresh models").onClick(async()=>{let P=p.components[0];await this.populateModelDropdown(P,n,!0)})})}new C.Setting(t).setName("Default Provider").setDesc("Select the default AI provider. You must reload the plugin for the change to take effect.").addDropdown(n=>{i.forEach(o=>{n.addOption(o,o.charAt(0).toUpperCase()+o.slice(1))}),n.setValue(this.plugin.settings.selectedProvider),n.onChange(async o=>{this.plugin.settings.selectedProvider=o,await this.plugin.saveSettings()})}),new C.Setting(t).setName("Use Perplexity").setDesc("Enable Perplexity integration (disables Tavily)").addToggle(n=>n.setValue(this.plugin.settings.usePerplexity).onChange(async o=>{this.plugin.settings.usePerplexity=o,await this.plugin.saveSettings(),this.display()}));let r=t.createEl("div",{cls:"setting-item-description",text:"Note: Currently, the Perplexity API does not support returning citations or images as these features are in closed beta. Additionally, the Perplexity API is a paid feature. After enabling Perplexity close and reopen the plugin for the change to take effect."});r.style.marginTop="10px",r.style.marginBottom="20px",r.style.color="var(--text-muted)",this.plugin.settings.usePerplexity?new C.Setting(t).setName("Perplexity API Key").setDesc("Enter your Perplexity API key").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.perplexityApiKey).onChange(async o=>{this.plugin.settings.perplexityApiKey=o,await this.plugin.saveSettings()})):new C.Setting(t).setName("Tavily API key").setDesc("Enter your Tavily API key").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.tavilyApiKey).onChange(async o=>{this.plugin.settings.tavilyApiKey=o,await this.plugin.saveSettings()})),new C.Setting(t).setName("YouTube API key").setDesc("Enter your YouTube API key for transcript fetching").addText(n=>n.setPlaceholder("Enter API key").setValue(this.plugin.settings.youtubeApiKey).onChange(async o=>{this.plugin.settings.youtubeApiKey=o,await this.plugin.saveSettings()})),new C.Setting(t).setName("Custom patterns folder").setDesc("Enter the path to your custom patterns folder").addText(n=>n.setPlaceholder("Custom Patterns").setValue(this.plugin.settings.customPatternsFolder).onChange(async o=>{this.plugin.settings.customPatternsFolder=o.replace(/\\/g,"/"),await this.plugin.saveSettings()})),new C.Setting(t).setName("Fabric patterns folder").setDesc("Enter the path to the fabric patterns folder").addText(n=>n.setPlaceholder("Fabric Patterns").setValue(this.plugin.settings.fabricPatternsFolder).onChange(async o=>{this.plugin.settings.fabricPatternsFolder=o.replace(/\\/g,"/"),await this.plugin.saveSettings()})),new C.Setting(t).setName("Download patterns").setDesc("Download patterns from GitHub").addButton(n=>{n.setButtonText("Download").onClick(async()=>{let o=n.buttonEl.textContent||"Download";n.setDisabled(!0),n.buttonEl.addClass("loading"),n.setButtonText("Downloading...");try{await this.plugin.downloadPatternsFromGitHub(),new C.Notice("Patterns downloaded successfully")}catch(p){console.error("Error downloading patterns:",p),new C.Notice(`Failed to download patterns: ${p instanceof Error?p.message:String(p)}`)}finally{n.setDisabled(!1),n.buttonEl.removeClass("loading"),n.setButtonText(o),this.display()}})}),new C.Setting(t).setName("Mesh output folder").setDesc("Enter the name of the folder for Mesh AI output. If it's in the root of your vault, just enter the folder name.").addText(n=>n.setPlaceholder("Mesh Output").setValue(this.plugin.settings.meshOutputFolder).onChange(async o=>{this.plugin.settings.meshOutputFolder=o.replace(/\\/g,"/"),await this.plugin.saveSettings()})),this.containerEl.createEl("h2",{text:"Workflows"}),this.workflowContainer=this.containerEl.createEl("div"),this.displayWorkflows(),new C.Setting(this.containerEl).setName("Add Workflow").addButton(n=>n.setButtonText("Add").onClick(()=>this.addWorkflow())),this.containerEl.createEl("h2",{text:"Pathways Settings"});let s=this.containerEl.createEl("div",{cls:"setting-item-description",text:"Currently, analyzing pathways is only supported using OpenRouter with either the o1-preview or o1-mini (o1-preview drastically out performs o1-mini which will result in better pathway analysis) models for their advanced reasoning capabilities. If cheaper models with similar performance are found in the future, they will be added as options. The o1 model is only for analysis of suggested pathways, creating backlinks will use the default provider and model."});s.style.marginBottom="20px",s.style.color="var(--text-muted)",new C.Setting(this.containerEl).setName("Pathways Model").setDesc("Select the model to use for pathway analysis").addDropdown(n=>n.addOption("o1-preview","o1-preview").addOption("o1-mini","o1-mini").setValue(this.plugin.settings.pathwaysModel).onChange(async o=>{this.plugin.settings.pathwaysModel=o,await this.plugin.saveSettings()})),new C.Setting(this.containerEl).setName("Pathways Output Folder").setDesc("Enter the path for the Pathways output folder").addText(n=>n.setPlaceholder("Pathways").setValue(this.plugin.settings.pathwaysOutputFolder).onChange(async o=>{this.plugin.settings.pathwaysOutputFolder=o,await this.plugin.saveSettings()})),new C.Setting(this.containerEl).setName("Default Pathway Workflow").setDesc("Select the default workflow to use for pathway creation. This workflow will be used to create backlinks for each pathway.").addDropdown(n=>{this.plugin.settings.workflows.forEach(o=>{n.addOption(o.name,o.name)}),n.setValue(this.plugin.settings.defaultPathwayWorkflow||"").onChange(async o=>{this.plugin.settings.defaultPathwayWorkflow=o,await this.plugin.saveSettings()})}),new C.Setting(t).setName("Enable debugging").setDesc("Turn on console logging for debugging purposes").addToggle(n=>n.setValue(this.plugin.settings.enableDebugging).onChange(async o=>{this.plugin.settings.enableDebugging=o;let p=this.plugin.settings.enableDebugging?"enabled":"disabled";new C.Notice(`Debugging ${p}.`),await this.plugin.saveSettings()}))}displayWorkflows(){this.workflowContainer.empty(),this.plugin.settings.workflows.forEach((t,e)=>{let i=new C.Setting(this.workflowContainer).setName(`Workflow ${e+1}`).addText(r=>r.setPlaceholder("Workflow name").setValue(t.name).onChange(async s=>{t.name=s,await this.plugin.saveSettings(),this.plugin.createWorkflowCommands()})).addDropdown(r=>{["openai","google","microsoft","anthropic","grocq","ollama","openrouter"].forEach(n=>r.addOption(n,n)),r.setValue(t.provider).onChange(async n=>{t.provider=n,await this.plugin.saveSettings(),this.plugin.createWorkflowCommands()})}).addText(r=>r.setPlaceholder("Pattern names (comma-separated)").setValue(t.patterns.join(", ")).onChange(async s=>{t.patterns=s.split(",").map(n=>n.trim()),await this.plugin.saveSettings(),this.plugin.createWorkflowCommands()})).addToggle(r=>r.setValue(t.usePatternStitching).setTooltip("Use pattern stitching").onChange(async s=>{t.usePatternStitching=s,await this.plugin.saveSettings()})).addButton(r=>r.setButtonText("Delete").onClick(async()=>{this.plugin.settings.workflows.splice(e,1),await this.plugin.saveSettings(),this.displayWorkflows(),this.plugin.createWorkflowCommands()}))})}async addWorkflow(){this.plugin.settings.workflows.push({name:"New Workflow",provider:"openai",patterns:[],usePatternStitching:!1}),await this.plugin.saveSettings(),this.displayWorkflows(),this.plugin.createWorkflowCommands()}async populateModelDropdown(t,e,i=!1){var r;t.selectEl.disabled=!0;try{let s;if(i?(s=await this.getModelsForProvider(e),this.plugin.settings.providerModels[e]=s,await this.plugin.saveSettings()):s=this.plugin.settings.providerModels[e]||await this.getModelsForProvider(e),t.selectEl.empty(),s&&s.length>0){s.forEach(p=>t.addOption(p,p));let n=(r=this.plugin.settings.providerModels[e])==null?void 0:r[0],o=s.includes(n)?n:s[0];t.setValue(o),this.plugin.settings.providerModels[e]=[o],await this.plugin.saveSettings(),t.onChange(async p=>{this.plugin.settings.providerModels[e]=[p],await this.plugin.saveSettings(),d(this.plugin,`Model for ${e} set to: ${p}`)})}else t.addOption("","No models available"),d(this.plugin,`No models available for ${e}`)}catch(s){d(this.plugin,`Error fetching models for ${e}:`,s),t.addOption("error","Error fetching models")}finally{t.selectEl.disabled=!1}}async getModelsForProvider(t){try{let e=this.plugin.getProvider(t);if(e&&"getAvailableModels"in e)return await e.getAvailableModels()}catch(e){d(this.plugin,`Error fetching models for ${t}:`,e)}return this.plugin.settings.providerModels[t]||[]}async testApiKey(t){try{if(!(t==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${t}ApiKey`])){new C.Notice(`Please enter an API key for ${t}`);return}await this.plugin.getProvider(t).getAvailableModels(),new C.Notice(`API key for ${t} is valid`);let r=this.containerEl.querySelector(`.mesh-provider-setting[data-provider="${t}"] .dropdown`);if(r){let s=new C.DropdownComponent(r);await this.populateModelDropdown(s,t,!0)}}catch(e){console.error(`Error testing API key for ${t}:`,e),new C.Notice(`Failed to validate API key for ${t}: ${e.message}`)}}hide(){super.hide(),this.plugin.reloadMeshView()}};f();var Ct={openaiApiKey:"",googleApiKey:"",microsoftApiKey:"",anthropicApiKey:"",grocqApiKey:"",tavilyApiKey:"",openrouterApiKey:"",usePerplexity:!1,perplexityApiKey:"",youtubeApiKey:"",ollamaServerUrl:"http://localhost:11434",microsoftEndpointUrl:"",selectedProvider:"openai",selectedModel:"",providerModels:{openai:[],google:[],microsoft:[],anthropic:[],grocq:[],ollama:[],openrouter:[],lmstudio:[]},customPatternsFolder:"",fabricPatternsFolder:"",meshOutputFolder:"",patternStitchingEnabled:!1,enableDebugging:!1,workflows:[],lmstudioApiKey:"",lmstudioServerUrl:"http://localhost:8000",pathwaysModel:"o1-preview",pathwaysOutputFolder:"",defaultPathwayWorkflow:"",pathwaysSearchProvider:"tavily"};f();f();var wt=require("obsidian");var z=class{constructor(a,t,e){this.baseUrl=a,this.headers=t,this.plugin=e}async get(a){return this.request(a,"GET")}async post(a,t,e=!1){return this.request(a,"POST",t,e)}async request(a,t,e,i=!1){let s={url:`${this.baseUrl}${a}`,method:t,headers:this.headers,contentType:"application/json"};e&&(s.body=JSON.stringify(e));try{let n=await(0,wt.requestUrl)(s);return i?n:n.json}catch(n){throw d(this.plugin,`HTTP error! status: ${n.status}`),new Error(`HTTP error! status: ${n.status}`)}}async postStream(a,t,e){let r={url:`${this.baseUrl}${a}`,method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(t)};try{let n=await(await(0,wt.requestUrl)(r)).arrayBuffer,p=new TextDecoder().decode(n).split(`
`).filter(m=>m.trim()!=="");for(let m of p)if(m.startsWith("data: ")){let P=m.slice(6);if(P==="[DONE]")break;try{let E=JSON.parse(P);e(E)}catch(E){d(this.plugin,`Error parsing JSON: ${E}`)}}}catch(s){throw d(this.plugin,`Error in postStream: ${s}`),s}}};var Ye=class{constructor(a,t){this.apiHelper=new z("https://api.openai.com/v1",{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},this.plugin),this.plugin=t}async generateResponse(a,t){let e=this.plugin.settings.providerModels.openai,i=e&&e.length>0?e[0]:"gpt-3.5-turbo";if(d(this.plugin,`Using OpenAI model: ${i}`),!i)throw new Error("No OpenAI model has been selected. Please choose a model in the settings.");let r="/chat/completions",s={model:i,messages:[{role:"system",content:te},{role:"user",content:a}],stream:!!t};try{if(t){let n="";return await this.apiHelper.postStream(r,s,o=>{if(o.choices&&o.choices[0].delta&&o.choices[0].delta.content){let p=o.choices[0].delta.content;n+=p,t(p)}}),n.trim()}else{let n=await this.apiHelper.post(r,s);if(n.choices&&n.choices[0]&&n.choices[0].message)return n.choices[0].message.content.trim();throw new Error("Unexpected response format from OpenAI API")}}catch(n){throw d(this.plugin,`Error generating response with model ${i}: ${n}`),n.response&&(d(this.plugin,`Response status: ${n.response.status}`),d(this.plugin,`Response data: ${JSON.stringify(n.response.data)}`)),new Error(`Failed to generate response: ${n.message}`)}}async getAvailableModels(){try{let a=await this.apiHelper.get("/models");if(a.data&&Array.isArray(a.data))return a.data.filter(t=>t.id.startsWith("gpt-")).map(t=>t.id);throw new Error("Unexpected response format from OpenAI API")}catch(a){throw d(this.plugin,`Error fetching OpenAI models: ${a}`),a}}};f();var Tt=require("obsidian");var Ge=class{constructor(a,t){this.apiHelper=new z("https://generativelanguage.googleapis.com/v1beta",{"x-goog-api-key":a},this.plugin),this.plugin=t}async getAvailableModels(){try{let a=await this.apiHelper.post("/models",{});if(a.models&&Array.isArray(a.models))return a.models.filter(t=>t.supportedGenerationMethods.includes("generateContent")).map(t=>t.name);throw new Error("Unexpected response format from Google API")}catch(a){throw d(this.plugin,`Error fetching Google models: ${a}`),a}}async generateResponse(a,t){let e=this.plugin.settings.providerModels.google,i=e&&e.length>0?e[0]:"chat-bison-001";i||new Tt.Notice('No Google model has been selected. Using default model "chat-bison-001".');let r="";try{return await this.apiHelper.postStream(`/models/${i}:streamGenerateContent`,{contents:[{parts:[{text:a}]}],safety_settings:[{category:"HARM_CATEGORY_DANGEROUS",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]},s=>{if(s.candidates&&s.candidates[0].content&&s.candidates[0].content.parts){let n=s.candidates[0].content.parts[0].text;r+=n,t&&t(n)}}),r}catch(s){throw d(this.plugin,`Error generating response with model ${i}: ${s}`),new Error(`Failed to generate response: ${s.message}`)}}};f();var _t=require("obsidian");var Xe=class{constructor(a,t){let e=t.settings.microsoftEndpointUrl||"https://api.cognitive.microsoft.com";this.apiHelper=new z(e,{"api-key":a},t),this.plugin=t}async getAvailableModels(){try{let a="/openai/deployments?api-version=2023-03-15-preview";d(this.plugin,`Fetching Microsoft models from: ${a}`);let t=await this.apiHelper.get(a);if(d(this.plugin,"Microsoft API response:",t),t.error)throw new Error(`Azure API Error: ${t.error.code} - ${t.error.message}`);if(t.data&&Array.isArray(t.data))return t.data.filter(e=>e.status==="succeeded"&&e.model&&typeof e.model=="string").map(e=>e.id);throw new Error("Unexpected response format from Microsoft API")}catch(a){throw d(this.plugin,`Error fetching Microsoft models: ${a}`),a}}async generateResponse(a,t){let e=this.plugin.settings.providerModels.microsoft,i=e&&e.length>0?e[0]:"gpt-35-turbo";i||new _t.Notice('No Microsoft model has been selected. Using default model "gpt-35-turbo".');let r="";try{return await this.apiHelper.postStream(`openai/deployments/${i}/completions?api-version=2023-05-15`,{messages:[{role:"system",content:te},{role:"user",content:a}],stream:!0},s=>{if(s.choices&&s.choices[0].delta&&s.choices[0].delta.content){let n=s.choices[0].delta.content;r+=n,t&&t(n)}}),r}catch(s){throw d(this.plugin,`Error generating response with model ${i}: ${s}`),new Error(`Failed to generate response: ${s.message}`)}}};f();var It=require("obsidian");var Qe=class{constructor(a,t){this.apiHelper=new z("https://api.anthropic.com/v1",{"x-api-key":a,"anthropic-version":"2023-06-01"},this.plugin),this.plugin=t}async getAvailableModels(){try{let a=await this.apiHelper.post("/models",{});if(a.models&&Array.isArray(a.models))return a.models.filter(t=>t.type==="chat").map(t=>t.id);throw new Error("Unexpected response format from Anthropic API")}catch(a){throw d(this.plugin,`Error fetching Anthropic models: ${a}`),a}}async generateResponse(a,t){let e=this.plugin.settings.providerModels.anthropic,i=e&&e.length>0?e[0]:"claude-2";i||new It.Notice('No Anthropic model has been selected. Using default model "claude-2".');let r="";try{return await this.apiHelper.postStream("/messages",{model:i,messages:[{role:"system",content:te},{role:"user",content:a}],max_tokens:1e3,stream:!0},s=>{var n;if(s.type==="content_block_delta"&&((n=s.delta)!=null&&n.text)){let o=s.delta.text;r+=o,t&&t(o)}}),r}catch(s){throw d(this.plugin,`Error generating response with model ${i}: ${s}`),new Error(`Failed to generate response: ${s.message}`)}}};f();var Lt=require("obsidian");var Ze=class{constructor(a,t){this.apiHelper=new z("https://api.groq.com/openai/v1",{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},this.plugin),this.plugin=t}async getAvailableModels(){try{let a=await this.apiHelper.get("/models");if(a.data&&Array.isArray(a.data))return a.data.map(t=>t.id);throw new Error("Unexpected response format from Groq API")}catch(a){throw d(this.plugin,`Error fetching Groq models: ${a}`),a}}async generateResponse(a,t){let e=this.plugin.settings.providerModels.grocq,i=e&&e.length>0?e[0]:"mixtral-8x7b-32768";i||new Lt.Notice('No Groq model has been selected. Using default model "mixtral-8x7b-32768".');try{let r=await this.apiHelper.post("/chat/completions",{model:i,messages:[{role:"system",content:te},{role:"user",content:a}]});if(r.choices&&r.choices.length>0){let s=r.choices[0].message.content;return t&&t(s),s}else throw new Error("No response content received from Groq API")}catch(r){throw d(this.plugin,`Error generating response with model ${i}: ${r}`),new Error(`Failed to generate response: ${r.message}`)}}};f();var Rt=require("obsidian");f();var et=require("obsidian");var tt=class{constructor(a,t){this.baseUrl=a,this.plugin=t,this.headers={"Content-Type":"application/json"}}async get(a){let t=`${this.baseUrl}${a}`,e=await(0,et.requestUrl)({url:t,method:"GET",headers:this.headers});if(e.status!==200)throw new Error(`HTTP error! status: ${e.status}`);return e.json}async post(a,t){let e=`${this.baseUrl}${a}`,i=await(0,et.requestUrl)({url:e,method:"POST",body:JSON.stringify(t),headers:this.headers});if(i.status!==200)throw new Error(`HTTP error! status: ${i.status}`);return i.json}async postStream(a,t,e){let i=`${this.baseUrl}${a}`,r=await(0,et.requestUrl)({url:i,method:"POST",body:JSON.stringify(t),headers:this.headers,throw:!1});if(r.status!==200)throw new Error(`HTTP error! status: ${r.status}`);let s=await r.arrayBuffer,n=new ReadableStream({start(p){p.enqueue(new Uint8Array(s)),p.close()}}).getReader(),o=new TextDecoder;try{let p="";for(;;){let{done:m,value:P}=await n.read();if(m)break;p+=o.decode(P,{stream:!0});let E;for(;(E=p.indexOf(`
`))!==-1;){let F=p.slice(0,E);if(p=p.slice(E+1),F.trim())try{let D=JSON.parse(F);e(D)}catch(D){d(this.plugin,`Error parsing JSON: ${D instanceof Error?D.message:String(D)}`)}}}}finally{n.releaseLock()}}};var it=class{constructor(a,t){this.apiHelper=new tt(a,this.plugin),this.plugin=t}async getAvailableModels(){try{let a=await this.apiHelper.get("/api/tags");if(a.models&&Array.isArray(a.models))return a.models.map(t=>t.name);throw new Error("Unexpected response format from Ollama API")}catch(a){throw d(this.plugin,`Error fetching Ollama models: ${a}`),new Error("Failed to fetch Ollama models. Please ensure the Ollama server is running and the URL is correct.")}}async generateResponse(a,t){let e=this.plugin.settings.providerModels.ollama,i=e&&e.length>0?e[0]:"llama2";i||new Rt.Notice('No Ollama model has been selected. Using default model "llama2".');let r="";try{return await this.apiHelper.postStream("/api/generate",{model:i,system:te,prompt:a,stream:!0},s=>{s.response&&(r+=s.response,t&&t(s.response))}),r}catch(s){throw d(this.plugin,`Error generating response with model ${i}: ${s}`),new Error(`Failed to generate response: ${s.message}`)}}};f();var bt=require("obsidian");var rt=class{constructor(a){this.plugin=a,d(this.plugin,"Initializing YoutubeProvider")}async getTranscript(a){d(this.plugin,`[getTranscript] Attempting to fetch transcript for URL: ${a}`);try{let t=this.extractVideoId(a);if(!t)throw new Error("Invalid YouTube URL, cannot extract video ID");let e=await this.grabTranscriptBase(t);if(!e)throw new Error("No transcript found for this video");let s=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("text"),n="";for(let o=0;o<s.length;o++)n+=s[o].textContent+" ";return d(this.plugin,`[getTranscript] Transcript fetched successfully. Length: ${n.length}`),n.trim()}catch(t){throw d(this.plugin,`[getTranscript] Error fetching YouTube transcript: ${t}`),t}}async grabTranscriptBase(a){let t=`https://www.youtube.com/watch?v=${a}`,i=(await(0,bt.requestUrl)({url:t})).text,r=/"captionTracks":(\[.*?\])/,s=i.match(r);if(s&&s[1]){let n=JSON.parse(s[1]);if(n.length>0){let o=n[0].baseUrl;return(await(0,bt.requestUrl)({url:o})).text}}return null}extractVideoId(a){let t=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,e=a.match(t);return e?e[1]:null}};f();var Ie=class{constructor(a,t){this.apiHelper=new z("https://api.tavily.com",{"Content-Type":"application/json"},this.plugin),this.plugin=t,this.apiKey=a}async search(a){try{let t=await this.apiHelper.post("/search",{api_key:this.apiKey,query:a,search_depth:"advanced",include_answer:!0,include_images:!0,include_raw_content:!1,max_results:10});if(t)return JSON.stringify(t);throw new Error("No results found in Tavily response")}catch(t){throw d(this.plugin,`Error fetching results from Tavily: ${t}`),t.response&&(d(this.plugin,`Response status: ${t.response.status}`),d(this.plugin,`Response data: ${JSON.stringify(t.response.data)}`)),new Error(`Failed to fetch results from Tavily: ${t.message}`)}}};f();var de=require("obsidian");var st=class extends de.Modal{constructor(t,e){super(t);this.selectedPatterns=[];this.currentSelectedIndex=-1;this.patternResultElements=[];this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),this.contentEl.addClass("mesh-modal"),this.loadingOverlay=t.createEl("div",{cls:"mesh-loading-overlay"}),this.loadingOverlay.createEl("div",{cls:"mesh-loading-spinner"}),this.loadingOverlay.style.display="none";let e={openai:"openai",google:"google",microsoft:"microsoft",anthropic:"anthropic",grocq:"grocq",ollama:"ollama",openrouter:"openrouter",lmstudio:"lmstudio"};new de.Setting(t).setName("Provider").setDesc("Select the AI provider").addDropdown(s=>(Object.values(e).forEach(n=>{(n==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${n}ApiKey`])&&s.addOption(n,n)}),s.setValue(this.plugin.settings.selectedProvider),s.onChange(n=>{this.plugin.settings.selectedProvider=n,this.plugin.saveSettings()}),this.providerSelect=s,s));let i=t.createEl("div",{cls:"pattern-card"}),r=i.createEl("div",{cls:"pattern-search-container"});this.patternInput=new de.TextComponent(r).setPlaceholder("Search patterns...").onChange(s=>{Se(this.plugin,s,this.patternResults,n=>{ge(n,this.selectedPatterns,()=>ue(this.selectedPatternsTitle,this.selectedPatternsContainer,this.selectedPatterns,o=>{this.selectedPatterns=o}),()=>this.patternInput.setValue(""),()=>this.patternResults.empty())},n=>{this.patternResultElements=n,this.currentSelectedIndex=n.length>0?0:-1,this.highlightCurrentResult()})}),this.patternInput.inputEl.addEventListener("keydown",this.handlePatternInputKeydown.bind(this)),this.patternResults=r.createEl("div",{cls:"pattern-results"}),this.selectedPatternsTitle=i.createEl("h4",{text:"Selected Patterns",cls:"mesh-selected-patterns-title"}),this.selectedPatternsContainer=i.createEl("div",{cls:"selected-patterns-container"}),new de.Setting(t).setName("Output File Name").setDesc("Enter a name for the output file (optional)").addText(s=>{this.outputFileNameInput=s.inputEl,s.setPlaceholder("Output file name")}),new de.Setting(t).addButton(s=>s.setButtonText("Process").onClick(()=>this.processActiveNote()))}async processActiveNote(){let t=this.app.workspace.getActiveFile();if(!t){new de.Notice("No active file");return}let e=await this.app.vault.read(t),i=this.outputFileNameInput;try{this.showLoading();let r;this.plugin.settings.patternStitchingEnabled?r=await re(this.plugin,this.plugin.settings.selectedProvider,this.selectedPatterns,e):r=await ie(this.plugin,this.plugin.settings.selectedProvider,this.selectedPatterns,e),await pe(this.plugin,r,i),this.close(),new de.Notice("Active note processed successfully")}catch(r){console.error("Error processing active note:",r),new de.Notice(`Error: ${r instanceof Error?r.message:String(r)}`)}finally{this.hideLoading()}}showLoading(){this.loadingOverlay.style.display="flex"}hideLoading(){this.loadingOverlay.style.display="none"}onClose(){let{contentEl:t}=this;t.empty()}handlePatternInputKeydown(t){(t.key==="ArrowDown"||t.key==="ArrowUp"||t.key==="Enter")&&(t.preventDefault(),t.key==="ArrowDown"?this.navigatePatternResults(1):t.key==="ArrowUp"?this.navigatePatternResults(-1):t.key==="Enter"&&this.selectCurrentPattern())}navigatePatternResults(t){let e=this.patternResultElements.length;e!==0&&(this.currentSelectedIndex=(this.currentSelectedIndex+t+e)%e,this.highlightCurrentResult())}highlightCurrentResult(){this.patternResultElements.forEach((t,e)=>{t.classList.toggle("selected",e===this.currentSelectedIndex)})}selectCurrentPattern(){var t;if(this.currentSelectedIndex>=0&&this.currentSelectedIndex<this.patternResultElements.length){let i=((t=this.patternResultElements[this.currentSelectedIndex].textContent)==null?void 0:t.trim())||"";this.handlePatternSelect(i)}}handlePatternSelect(t){ge(t,this.selectedPatterns,()=>ue(this.containerEl.querySelector(".mesh-selected-patterns-title"),this.selectedPatternsContainer,this.selectedPatterns,e=>{this.selectedPatterns=e}),()=>this.patternInput.setValue(""),()=>{this.patternResults.empty(),this.patternResultElements=[],this.currentSelectedIndex=-1})}};f();var G=require("obsidian");var nt=class extends G.Modal{constructor(t,e){super(t);this.selectedPatterns=[];this.currentSelectedIndex=-1;this.patternResultElements=[];this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),this.contentEl.addClass("mesh-modal"),this.loadingOverlay=t.createEl("div",{cls:"mesh-loading-overlay"}),this.loadingOverlay.createEl("div",{cls:"mesh-loading-spinner"}),this.loadingOverlay.style.display="none";let e={openai:"openai",google:"google",microsoft:"microsoft",anthropic:"anthropic",grocq:"grocq",ollama:"ollama",openrouter:"openrouter",lmstudio:"lmstudio"};new G.Setting(t).setName("Provider").setDesc("Select the AI provider").addDropdown(s=>(Object.values(e).forEach(n=>{(n==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${n}ApiKey`])&&s.addOption(n,n)}),s.setValue(this.plugin.settings.selectedProvider),s.onChange(n=>{this.plugin.settings.selectedProvider=n,this.plugin.saveSettings()}),this.providerSelect=s,s)),new G.Setting(t).setName("Clipboard Content").setDesc("Preview of clipboard content (read-only)").addTextArea(s=>{this.clipboardPreview=s.inputEl,s.setPlaceholder("Clipboard content will appear here"),s.inputEl.rows=5,s.inputEl.cols=50,s.inputEl.readOnly=!0}),new G.Setting(t).addButton(s=>s.setButtonText("Refresh clipboard").onClick(()=>this.refreshClipboardContent()));let i=t.createEl("div",{cls:"pattern-card"}),r=i.createEl("div",{cls:"pattern-search-container"});this.patternInput=new G.TextComponent(r).setPlaceholder("Search patterns...").onChange(s=>{Se(this.plugin,s,this.patternResults,n=>{ge(n,this.selectedPatterns,()=>ue(this.selectedPatternsTitle,this.selectedPatternsContainer,this.selectedPatterns,o=>{this.selectedPatterns=o}),()=>this.patternInput.setValue(""),()=>this.patternResults.empty())},n=>{this.patternResultElements=n,this.currentSelectedIndex=n.length>0?0:-1,this.highlightCurrentResult()})}),this.patternInput.inputEl.addEventListener("keydown",this.handlePatternInputKeydown.bind(this)),this.patternResults=r.createEl("div",{cls:"pattern-results"}),this.selectedPatternsTitle=i.createEl("h4",{text:"Selected Patterns",cls:"mesh-selected-patterns-title"}),this.selectedPatternsContainer=i.createEl("div",{cls:"selected-patterns-container"}),new G.Setting(t).setName("Output File Name").setDesc("Enter a name for the output file (optional)").addText(s=>{this.outputFileNameInput=s.inputEl,s.setPlaceholder("Output file name")}),new G.Setting(t).addButton(s=>s.setButtonText("New note").onClick(()=>this.processClipboard())).addButton(s=>s.setButtonText("In place").onClick(()=>this.processClipboard(!0))),this.refreshClipboardContent()}async refreshClipboardContent(){try{let t=await navigator.clipboard.readText();this.clipboardPreview.value=t}catch(t){console.error("Failed to read clipboard contents:",t),new G.Notice("Failed to read clipboard contents. Please ensure you have given the necessary permissions.")}}async processClipboard(t=!1){let e=this.clipboardPreview.value;if(!e){new G.Notice("No clipboard content");return}let i=this.outputFileNameInput;try{this.showLoading();let r;this.plugin.settings.patternStitchingEnabled?r=await re(this.plugin,this.plugin.settings.selectedProvider,this.selectedPatterns,e):r=await ie(this.plugin,this.plugin.settings.selectedProvider,this.selectedPatterns,e),t?await Ke(this.plugin,r):await pe(this.plugin,r,i),this.close(),new G.Notice("Clipboard content processed successfully")}catch(r){console.error("Error processing clipboard content:",r),new G.Notice(`Error: ${r instanceof Error?r.message:String(r)}`)}finally{this.hideLoading()}}showLoading(){this.loadingOverlay.style.display="flex"}hideLoading(){this.loadingOverlay.style.display="none"}onClose(){let{contentEl:t}=this;t.empty()}handlePatternInputKeydown(t){(t.key==="ArrowDown"||t.key==="ArrowUp"||t.key==="Enter")&&(t.preventDefault(),t.key==="ArrowDown"?this.navigatePatternResults(1):t.key==="ArrowUp"?this.navigatePatternResults(-1):t.key==="Enter"&&this.selectCurrentPattern())}navigatePatternResults(t){let e=this.patternResultElements.length;e!==0&&(this.currentSelectedIndex=(this.currentSelectedIndex+t+e)%e,this.highlightCurrentResult())}highlightCurrentResult(){this.patternResultElements.forEach((t,e)=>{t.classList.toggle("selected",e===this.currentSelectedIndex)})}selectCurrentPattern(){var t;if(this.currentSelectedIndex>=0&&this.currentSelectedIndex<this.patternResultElements.length){let i=((t=this.patternResultElements[this.currentSelectedIndex].textContent)==null?void 0:t.trim())||"";this.handlePatternSelect(i)}}handlePatternSelect(t){ge(t,this.selectedPatterns,()=>ue(this.containerEl.querySelector(".mesh-selected-patterns-title"),this.selectedPatternsContainer,this.selectedPatterns,e=>{this.selectedPatterns=e}),()=>this.patternInput.setValue(""),()=>{this.patternResults.empty(),this.patternResultElements=[],this.currentSelectedIndex=-1})}};f();var ae=require("obsidian");var at=class extends ae.Modal{constructor(t,e){super(t);this.selectedPatterns=[];this.currentSelectedIndex=-1;this.patternResultElements=[];this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("mesh-modal"),this.loadingOverlay=t.createEl("div",{cls:"mesh-loading-overlay"}),this.loadingOverlay.createEl("div",{cls:"mesh-loading-spinner"}),this.loadingOverlay.style.display="none";let e={openai:"openai",google:"google",microsoft:"microsoft",anthropic:"anthropic",grocq:"grocq",ollama:"ollama",openrouter:"openrouter",lmstudio:"lmstudio"};new ae.Setting(t).setName("Provider").setDesc("Select the AI provider").addDropdown(s=>(Object.values(e).forEach(n=>{(n==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${n}ApiKey`])&&s.addOption(n,n)}),s.setValue(this.plugin.settings.selectedProvider),s.onChange(n=>{this.plugin.settings.selectedProvider=n,this.plugin.saveSettings()}),this.providerSelect=s,s)),new ae.Setting(t).setName("Tavily Search").setDesc("Enter your search query").addText(s=>{this.searchInput=s.inputEl,s.setPlaceholder("Enter search query")});let i=t.createEl("div",{cls:"pattern-card"}),r=i.createEl("div",{cls:"pattern-search-container"});this.patternInput=new ae.TextComponent(r).setPlaceholder("Search patterns...").onChange(s=>{Se(this.plugin,s,this.patternResults,this.handlePatternSelect.bind(this),n=>{this.patternResultElements=n,this.currentSelectedIndex=n.length>0?0:-1,this.highlightCurrentResult()})}),this.patternInput.inputEl.addEventListener("keydown",this.handleKeyDown.bind(this)),this.patternResults=r.createEl("div",{cls:"pattern-results"}),this.selectedPatternsTitle=i.createEl("h4",{text:"Selected Patterns",cls:"mesh-selected-patterns-title"}),this.selectedPatternsContainer=i.createEl("div",{cls:"selected-patterns-container"}),new ae.Setting(t).setName("Output File Name").setDesc("Enter a name for the output file (optional)").addText(s=>{this.outputFileNameInput=s.inputEl,s.setPlaceholder("Output file name")}),new ae.Setting(t).addButton(s=>s.setButtonText("New note").onClick(()=>this.processSearch())).addButton(s=>s.setButtonText("In place").onClick(()=>this.processSearch(!0)))}async processSearch(t=!1){if(!this.searchInput.value){new ae.Notice("Please enter a search query");return}try{this.showLoading();let e=await this.plugin.tavilyProvider.search(this.searchInput.value),i;this.plugin.settings.patternStitchingEnabled?i=await re(this.plugin,this.plugin.settings.selectedProvider,this.selectedPatterns,e):i=await ie(this.plugin,this.plugin.settings.selectedProvider,this.selectedPatterns,e),t?await Ke(this.plugin,i):await pe(this.plugin,i,this.outputFileNameInput.value),this.close(),new ae.Notice("Search processed successfully")}catch(e){console.error("Error processing search:",e),new ae.Notice(`Error: ${e instanceof Error?e.message:String(e)}`)}finally{this.hideLoading()}}showLoading(){this.loadingOverlay.style.display="flex"}hideLoading(){this.loadingOverlay.style.display="none"}onClose(){let{contentEl:t}=this;t.empty()}handlePatternSelect(t){ge(t,this.selectedPatterns,()=>ue(this.selectedPatternsTitle,this.selectedPatternsContainer,this.selectedPatterns,e=>{this.selectedPatterns=e}),()=>this.patternInput.setValue(""),()=>{this.patternResults.empty(),this.patternResultElements=[],this.currentSelectedIndex=-1})}handleKeyDown(t){if(this.patternResultElements.length!==0)switch(t.key){case"ArrowDown":t.preventDefault(),this.currentSelectedIndex=(this.currentSelectedIndex+1)%this.patternResultElements.length,this.highlightCurrentResult();break;case"ArrowUp":t.preventDefault(),this.currentSelectedIndex=(this.currentSelectedIndex-1+this.patternResultElements.length)%this.patternResultElements.length,this.highlightCurrentResult();break;case"Enter":if(t.preventDefault(),this.currentSelectedIndex!==-1){let e=this.patternResultElements[this.currentSelectedIndex].textContent;e&&this.handlePatternSelect(e)}break}}highlightCurrentResult(){this.patternResultElements.forEach((t,e)=>{t.classList.toggle("selected",e===this.currentSelectedIndex)}),this.currentSelectedIndex!==-1&&this.patternResultElements[this.currentSelectedIndex].scrollIntoView({block:"nearest",inline:"nearest"})}};f();var Re=require("obsidian");f();async function Nt(l,a,t){return a.usePatternStitching==!0?await re(l,a.provider,a.patterns,t):await ie(l,a.provider,a.patterns,t)}var ot=class extends Re.Modal{constructor(t,e,i){super(t);this.searchQuery="";this.plugin=e,this.workflow=i,this.tavilyProvider=new Ie(this.plugin.settings.tavilyApiKey,this.plugin)}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("mesh-modal-tavily"),this.loadingOverlay=t.createEl("div",{cls:"mesh-loading-overlay"}),this.loadingOverlay.createEl("div",{cls:"mesh-loading-spinner"}),this.loadingOverlay.style.display="none",t.createEl("h2",{text:"Tavily Search",cls:"mesh-modal-tavily-title"});let e=t.createEl("div",{cls:"mesh-modal-tavily-search-container"});e.createEl("input",{type:"text",placeholder:"Enter your search query",cls:"mesh-tavily-input"}).addEventListener("input",s=>this.searchQuery=s.target.value),e.createEl("span",{text:"\u{1F50D}",cls:"mesh-modal-tavily-search-icon"}),t.createEl("button",{text:"Run Workflow",cls:"mesh-modal-tavily-button"}).addEventListener("click",()=>this.runWorkflow())}async runWorkflow(){if(!this.searchQuery){new Re.Notice("Please enter a search query");return}try{this.showLoading();let t=await this.tavilyProvider.search(this.searchQuery),e=await Nt(this.plugin,this.workflow,t),i=`Workflow Output ${new Date().toISOString().replace(/:/g,"-")}`;await pe(this.plugin,e,i),new Re.Notice("Workflow processed successfully"),this.close()}catch(t){console.error("Error processing workflow:",t),new Re.Notice(`Error: ${t instanceof Error?t.message:String(t)}`)}finally{this.hideLoading()}}showLoading(){this.loadingOverlay.style.display="flex"}hideLoading(){this.loadingOverlay.style.display="none"}onClose(){let{contentEl:t}=this;t.empty()}};f();var lt=class{constructor(a,t){this.apiHelper=new z("https://api.perplexity.ai",{accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${a}`},t),this.plugin=t,this.apiKey=a}async search(a){try{let t=await this.apiHelper.post("/chat/completions",{model:"llama-3.1-sonar-large-128k-online",messages:[{role:"system",content:"Be precise and concise."},{role:"user",content:a}],return_images:!0});if(t&&t.choices&&t.choices.length>0)return t.choices[0].message.content;throw new Error("No results found in Perplexity response")}catch(t){throw d(this.plugin,`Error fetching results from Perplexity: ${t}`),t.response&&(d(this.plugin,`Response status: ${t.response.status}`),d(this.plugin,`Response data: ${JSON.stringify(t.response.data)}`)),new Error(`Failed to fetch results from Perplexity: ${t.message}`)}}};f();var ct=class{constructor(a,t){this.apiHelper=new z("https://openrouter.ai/api/v1",{Authorization:`Bearer ${a}`,"Content-Type":"application/json","HTTP-Referer":"https://github.com/chasebank87/mesh-ai","X-Title":"Mesh AI Plugin for Obsidian"},t),this.plugin=t}async generateResponse(a,t){let i=a.includes(We)?this.plugin.settings.pathwaysModel:this.plugin.settings.providerModels.openrouter[0]||"openai/gpt-3.5-turbo";if(d(this.plugin,`Using OpenRouter model: ${i}`),!i)throw new Error("No OpenRouter model has been selected. Please choose a model in the settings.");let r="/chat/completions",s={model:i,messages:[{role:"system",content:te},{role:"user",content:a}],stream:!!t};try{if(t){let n="";return await this.apiHelper.postStream(r,s,o=>{if(o.choices&&o.choices[0].delta&&o.choices[0].delta.content){let p=o.choices[0].delta.content;n+=p,t(p)}}),n.trim()}else{let n=await this.apiHelper.post(r,s);if(n.choices&&n.choices[0]&&n.choices[0].message)return n.choices[0].message.content.trim();throw new Error("Unexpected response format from OpenRouter API")}}catch(n){throw d(this.plugin,`Error generating response with model ${i}: ${n}`),n.response&&(d(this.plugin,`Response status: ${n.response.status}`),d(this.plugin,`Response data: ${JSON.stringify(n.response.data)}`)),new Error(`Failed to generate response: ${n.message}`)}}async getAvailableModels(){try{let a=await this.apiHelper.get("/models");if(a.data&&Array.isArray(a.data))return a.data.map(t=>t.id);throw new Error("Unexpected response format from OpenRouter API")}catch(a){throw d(this.plugin,`Error fetching OpenRouter models: ${a}`),a}}};f();var Ot=require("obsidian");var pt=class{constructor(a,t){this.plugin=t,this.apiHelper=new z(a,{"Content-Type":"application/json"},t)}async getAvailableModels(){try{let a=await this.apiHelper.get("/v1/models");if(a.data&&Array.isArray(a.data))return a.data.map(t=>t.id);throw new Error("Unexpected response format from LMStudio API")}catch(a){throw d(this.plugin,`Error fetching LMStudio models: ${a}`),a}}async generateResponse(a,t){let e=this.plugin.settings.providerModels.lmstudio,i=e&&e.length>0?e[0]:"default-model";i||new Ot.Notice("No LMStudio model has been selected. Using default model.");try{let r=await this.apiHelper.post("/v1/chat/completions",{model:i,messages:[{role:"system",content:te},{role:"user",content:a}],stream:!1});if(r.choices&&r.choices.length>0){let s=r.choices[0].message.content;return t&&t(s),s}else throw new Error("No response content received from LMStudio API")}catch(r){throw d(this.plugin,`Error generating response with model ${i}: ${r}`),new Error(`Failed to generate response: ${r.message}`)}}};f();var K=require("obsidian");f();var Ht=`
            <p>Below are potential topics, ideas, or events to enhance your vault:</p>
            <ul>
                <li><strong>Link</strong>: Creates a backlink to an existing file.</li>
                <li><strong>Create</strong>: Generates a new note and backlink using your chosen workflow.</li>
            </ul>
`;var dt=class extends K.Modal{constructor(t,e,i){super(t);this.plugin=e,this.content=i,this.pathways=[]}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("mesh-analyze-pathways-modal"),t.createEl("h2",{text:"Analyze Pathways",cls:"modal-header"});let e=t.createEl("p",{text:"Warning: Using o1 models can be expensive. Check the pricing from OpenRouter before continuing.",cls:"mesh-warning-message"});this.loadingOverlay=t.createEl("div",{cls:"mesh-analyze-pathways-loading-overlay"}),this.loadingOverlay.createEl("div",{cls:"mesh-analyze-pathways-loading-spinner"}),this.loadingOverlay.addClass("hidden"),new K.Setting(t).setName("Confirm Analysis").setDesc("Click to analyze the current document and suggest pathways.").addButton(i=>i.setButtonText("Analyze").onClick(()=>this.analyzePathways()))}async analyzePathways(){this.showLoading(),d(this.plugin,"Starting analyzePathways");try{let t=this.plugin.getProvider("openrouter");d(this.plugin,"Using provider: openrouter");let e=await this.getAllFiles(),i=this.content+`

<files>
`+e+`
</files>`,r=await t.generateResponse(We+`

Input:
`+i);d(this.plugin,"Received response from provider"),d(this.plugin,`Response: ${r}`);let s=r.replace(/[\n\r\t]/g,"").replace(/\s+/g," ");this.pathways=JSON.parse(s),d(this.plugin,`Parsed pathways: ${JSON.stringify(this.pathways)}`),this.displayPathways()}catch(t){d(this.plugin,`Error in analyzePathways: ${t.message}`),new K.Notice(`Error analyzing pathways: ${t.message}`),console.error(t)}finally{this.hideLoading()}}async getAllFiles(){return this.app.vault.getFiles().map(e=>e.name).join(`
`)}displayPathways(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Suggested Pathways",cls:"modal-header"});let e=t.createEl("div",{cls:"mesh-instructions"});e.innerHTML=Ht;let i=t.createEl("div",{cls:"pathway-list"});this.pathways.forEach((n,o)=>{let p=i.createEl("div",{cls:"pathway-item"}),m=p.createEl("div",{cls:"pathway-header"});m.createEl("span",{text:n.backlink,cls:"pathway-backlink"});let P=m.createEl("div",{cls:"button-container"}),E=P.createEl("button",{text:"Create",cls:"create-pathway-button"});E.onclick=()=>this.createPathway(n,p);let F=P.createEl("button",{text:"Delete",cls:"delete-pathway-button hidden"});if(F.onclick=()=>this.deletePathway(n,p),n["potential links"]&&n["potential links"].length>0){let D=p.createEl("h4",{text:"Found Links:",cls:"potential-links-header"}),A=p.createEl("ul",{cls:"potential-links-list"});n["potential links"].forEach(N=>{let W=A.createEl("li",{cls:"potential-link-item"});W.createEl("span",{text:N,cls:"potential-link-text"});let Pe=W.createEl("button",{text:"Link",cls:"link-button"});Pe.onclick=()=>this.createPotentialLink(n,N,W);let se=W.createEl("button",{text:"Delete",cls:"delete-link-button hidden"});se.onclick=()=>this.deletePotentialLink(N,W)})}});let r=t.createEl("button",{text:"Create All",cls:"create-all-button"});r.onclick=()=>this.createAllPathways();let s=t.createEl("div",{cls:"scroll-indicator"});s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-down"><polyline points="7 13 12 18 17 13"></polyline><polyline points="7 6 12 11 17 6"></polyline></svg>'}async createPathway(t,e){e?this.showItemLoading(e):this.showLoading(),d(this.plugin,`Starting createPathway for ${t.backlink}`);let{backlink:i,content:r,match:s}=t,o=`${this.plugin.settings.pathwaysOutputFolder}/${i}.md`;try{let p=this.plugin.settings.defaultPathwayWorkflow,m=this.plugin.settings.workflows.find(A=>A.name===p);if(!m)throw new Error("No default pathway workflow selected");let E=await(this.plugin.settings.pathwaysSearchProvider==="tavily"?this.plugin.tavilyProvider:this.plugin.perplexityProvider).search(r),F;m.usePatternStitching?F=await re(this.plugin,m.provider,m.patterns,E):F=await ie(this.plugin,m.provider,m.patterns,E),await this.app.vault.create(o,F),d(this.plugin,`Created file: ${o}`);let D=this.app.workspace.getActiveViewOfType(K.MarkdownView);if(D){let A=D.editor,W=A.getValue().indexOf(s)+s.length;A.replaceRange(` [[${i}]]`,A.offsetToPos(W)),d(this.plugin,`Inserted backlink: [[${i}]]`)}else d(this.plugin,"No active view found for inserting backlink");if(e){let A=e.querySelector(".create-pathway-button"),N=e.querySelector(".delete-pathway-button");A&&A.addClass("hidden"),N&&N.removeClass("hidden")}new K.Notice(`Pathway created: ${i}`)}catch(p){d(this.plugin,`Error in createPathway: ${p.message}`),new K.Notice(`Error creating pathway: ${p.message}`),console.error(p)}finally{e?this.hideItemLoading(e):this.hideLoading()}}async createPotentialLink(t,e,i){this.showItemLoading(i);try{let r=this.app.workspace.getActiveViewOfType(K.MarkdownView);if(r){let o=r.editor,m=o.getValue().length;o.replaceRange(`
[[${e}]]`,o.offsetToPos(m)),d(this.plugin,`Created potential link: [[${e}]]`)}let s=i.querySelector(".link-button");s&&s.remove();let n=i.querySelector(".delete-link-button");if(n)n.removeClass("hidden");else{let o=i.createEl("button",{text:"Delete",cls:"delete-link-button"});o.onclick=()=>this.deletePotentialLink(e,i)}new K.Notice(`Potential link created: ${e}`)}catch(r){d(this.plugin,`Error in createPotentialLink: ${r.message}`),new K.Notice(`Error creating potential link: ${r.message}`),console.error(r)}finally{this.hideItemLoading(i)}}async createAllPathways(){this.showLoading();for(let t of this.pathways)await this.createPathway(t);this.hideLoading(),this.close()}showLoading(){this.loadingOverlay.removeClass("hidden")}hideLoading(){this.loadingOverlay.addClass("hidden")}showItemLoading(t){t.createEl("div",{cls:"mesh-analyze-pathways-loading-overlay"}).createEl("div",{cls:"mesh-analyze-pathways-loading-spinner"})}hideItemLoading(t){let e=t.querySelector(".mesh-analyze-pathways-loading-overlay");e&&e.remove()}onClose(){let{contentEl:t}=this;t.empty()}async deletePotentialLink(t,e){try{let i=this.app.workspace.getActiveViewOfType(K.MarkdownView);if(i){let n=i.editor,o=n.getValue(),p=new RegExp(`\\[\\[${t}\\]\\]`,"g"),m=o.replace(p,"");n.setValue(m),d(this.plugin,`Deleted potential link: [[${t}]]`)}let r=e.querySelector(".delete-link-button");r&&r.remove();let s=e.querySelector(".link-button");if(s)s.removeClass("hidden");else{let n=e.createEl("button",{text:"Link",cls:"link-button"});n.onclick=()=>this.createPotentialLink(null,t,e)}new K.Notice(`Potential link deleted: ${t}`)}catch(i){d(this.plugin,`Error in deletePotentialLink: ${i.message}`),new K.Notice(`Error deleting potential link: ${i.message}`),console.error(i)}}async deletePathway(t,e){this.showItemLoading(e),d(this.plugin,`Starting deletePathway for ${t.backlink}`);let{backlink:i,match:r}=t,n=`${this.plugin.settings.pathwaysOutputFolder}/${i}.md`;try{await this.app.vault.adapter.remove(n),d(this.plugin,`Deleted file: ${n}`);let o=this.app.workspace.getActiveViewOfType(K.MarkdownView);if(o){let P=o.editor,F=P.getValue().replace(` [[${i}]]`,"");P.setValue(F),d(this.plugin,`Removed backlink: [[${i}]]`)}let p=e.querySelector(".delete-pathway-button"),m=e.querySelector(".create-pathway-button");p&&p.addClass("hidden"),m&&m.removeClass("hidden"),new K.Notice(`Pathway deleted: ${i}`)}catch(o){d(this.plugin,`Error in deletePathway: ${o.message}`),new K.Notice(`Error deleting pathway: ${o.message}`),console.error(o)}finally{this.hideItemLoading(e)}}};var ut=class extends O.Plugin{async onload(){await this.loadSettings(),this.fixFolderPaths(),this.youtubeProvider=new rt(this),this.tavilyProvider=new Ie(this.settings.tavilyApiKey,this),this.addSettingTab(new je(this.app,this)),this.registerView(_e,t=>new $e(t,this)),this.addCommand({id:"process-active-note",name:"Process Active Note",callback:()=>{new st(this.app,this).open()}}),this.addCommand({id:"process-clipboard",name:"Process Clipboard",callback:()=>{new nt(this.app,this).open()}}),this.addCommand({id:"tavily-search",name:"Tavily Search",callback:()=>{new at(this.app,this).open()}}),this.addCommand({id:"analyze-pathways",name:"Analyze Pathways",callback:()=>{let t=this.app.workspace.getActiveViewOfType(O.MarkdownView);if(t){let e=t.getViewData();new dt(this.app,this,e).open()}else new O.Notice("Please open a markdown file to analyze pathways.")}}),this.createWorkflowCommands(),this.addRibbonIcon("brain","Mesh AI Integration",()=>{this.activateView()})}createWorkflowCommands(){this.removeWorkflowCommands(),this.settings.workflows.forEach((t,e)=>{this.addCommand({id:`mesh-ai-workflow-${e+1}-active-note`,name:`Run Workflow: ${t.name} (Active Note)`,callback:()=>this.runWorkflow(t,"active-note")}),this.addCommand({id:`mesh-ai-workflow-${e+1}-clipboard`,name:`Run Workflow: ${t.name} (Clipboard)`,callback:()=>this.runWorkflow(t,"clipboard")}),this.addCommand({id:`mesh-ai-workflow-${e+1}-tavily`,name:`Run Workflow: ${t.name} (Tavily)`,callback:()=>new ot(this.app,this,t).open()})})}removeWorkflowCommands(){}async runWorkflow(t,e){let i=new O.Notice(`Running workflow: ${t.name}...`,0),r;try{let s;t.usePatternStitching?(r=await Oe(this.app,this,e),s=await re(this,t.provider,t.patterns,r)):(r=await Oe(this.app,this,e),s=await ie(this,t.provider,t.patterns,r));let n=`Workflow Output ${new Date().toISOString().replace(/:/g,"-")}`;await pe(this,s,n),new O.Notice(`Workflow '${t.name}' processed successfully`)}catch(s){console.error("Error processing workflow:",s),new O.Notice(`Error in workflow '${t.name}': ${s instanceof Error?s.message:String(s)}`)}finally{i.hide()}}async loadParticlesJS(){return new Promise(t=>{typeof window.particlesJS=="function"?(console.log("particlesJS loaded successfully"),t()):(console.error("particlesJS is not available"),t())})}async loadSettings(){this.settings=Object.assign({},Ct,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=t.getLeavesOfType(_e)[0];if(!e){let i=t.getRightLeaf(!1);i?(await i.setViewState({type:_e,active:!0}),e=i):(e=t.getLeaf("split","vertical"),await e.setViewState({type:_e,active:!0}))}t.revealLeaf(e)}async loadAllPatterns(){let t=await this.loadCustomPatterns(),e=await this.loadFabricPatterns();return[...new Set([...t,...e])].sort()}async loadCustomPatterns(){let t=this.app.vault.getAbstractFileByPath(this.settings.customPatternsFolder),e=[];if(t instanceof O.TFolder)for(let i of t.children)i instanceof O.TFile&&i.extension==="md"&&e.push(i.basename);return e.sort()}async loadFabricPatterns(){let t=(0,O.normalizePath)(this.settings.fabricPatternsFolder),e=this.app.vault.getAbstractFileByPath(t),i=[];if(e instanceof O.TFolder)for(let r of e.children)r instanceof O.TFile&&r.extension==="md"&&i.push(r.basename);return i.sort()}async downloadPatternsFromGitHub(){let t="https://api.github.com/repos/danielmiessler/fabric/contents/patterns",e="https://raw.githubusercontent.com/danielmiessler/fabric/main/patterns";try{let i=(0,O.normalizePath)(this.settings.fabricPatternsFolder);this.app.vault.getAbstractFileByPath(i)instanceof O.TFolder||await this.app.vault.createFolder(i);let o=(await(0,O.requestUrl)({url:t})).json.filter(P=>P.type==="dir"),p=0,m=0;for(let P of o)try{let E=`${P.name}.md`,F=`${e}/${P.name}/system.md`,D=(0,O.normalizePath)(`${this.settings.fabricPatternsFolder}/${E}`),A=await(0,O.requestUrl)({url:F}),N=this.app.vault.getAbstractFileByPath(D);N instanceof O.TFile?(await this.app.vault.modify(N,A.text),d(this,`Updated existing file: ${E}`)):(await this.app.vault.create(D,A.text),d(this,`Created new file: ${E}`)),p++}catch(E){d(this,`Error processing ${P.name}:`,E),E instanceof Error&&(d(this,`Error message: ${E.message}`),d(this,`Error stack: ${E.stack}`)),m++}new O.Notice(`Successfully downloaded/updated ${p} patterns. ${m} failed.`),await this.loadAllPatterns()}catch(i){d(this,"Error in downloadPatternsFromGitHub:",i),new O.Notice(`Failed to download patterns: ${i.message}`)}}async clearFabricPatternsFolder(){let t=this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder);if(t instanceof O.TFolder)for(let e of t.children)e instanceof O.TFile&&await this.app.fileManager.trashFile(e);else await this.app.vault.createFolder(this.settings.fabricPatternsFolder)}getProvider(t){switch(t){case"openai":return new Ye(this.settings.openaiApiKey,this);case"google":return new Ge(this.settings.googleApiKey,this);case"microsoft":return new Xe(this.settings.microsoftApiKey,this);case"anthropic":return new Qe(this.settings.anthropicApiKey,this);case"grocq":return new Ze(this.settings.grocqApiKey,this);case"ollama":return new it(this.settings.ollamaServerUrl,this);case"openrouter":return new ct(this.settings.openrouterApiKey,this);case"lmstudio":return new pt(this.settings.lmstudioServerUrl,this);default:throw new Error(`Unknown provider: ${t}`)}}getSearchProvider(t){switch(t){case"tavily":return new Ie(this.settings.tavilyApiKey,this);case"perplexity":return new lt(this.settings.perplexityApiKey,this);default:throw new Error(`Unsupported search provider: ${t}`)}}reloadMeshView(){this.app.workspace.getLeavesOfType(_e).forEach(e=>{e.view instanceof $e&&e.view.onOpen()})}fixFolderPaths(){let t=["customPatternsFolder","fabricPatternsFolder","meshOutputFolder"],e=!1;for(let i of t)typeof this.settings[i]=="string"&&this.settings[i].includes("\\")&&(this.settings[i]=this.settings[i].replace(/\\/g,"/"),e=!0);e&&this.saveSettings()}};
