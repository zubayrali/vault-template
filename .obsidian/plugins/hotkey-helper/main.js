var O=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var H=(r,l)=>{for(var t in l)O(r,t,{get:l[t],enumerable:!0})},q=(r,l,t,i)=>{if(l&&typeof l=="object"||typeof l=="function")for(let n of W(l))!F.call(r,n)&&n!==t&&O(r,n,{get:()=>l[n],enumerable:!(i=D(l,n))||i.enumerable});return r};var $=r=>q(O({},"__esModule",{value:!0}),r);var tt={};H(tt,{default:()=>P});module.exports=$(tt);var y=require("obsidian");function w(r,l){let t=Object.keys(l).map(i=>J(r,i,l[i]));return t.length===1?t[0]:function(){t.forEach(i=>i())}}function J(r,l,t){let i=r[l],n=r.hasOwnProperty(l),e=t(i);return i&&Object.setPrototypeOf(e,i),Object.setPrototypeOf(s,e),r[l]=s,u;function s(...o){return e===i&&r[l]===s&&u(),e.apply(this,o)}function u(){r[l]===s&&(n?r[l]=i:delete r[l]),e!==i&&(e=i,Object.setPrototypeOf(s,i||Function))}}function B(r,l){return r.then(l,l)}function R(r){let l=Promise.resolve();function t(...i){return l=new Promise((n,e)=>{B(l,()=>{r.apply(this,i).then(n,e)})})}return t.after=function(){return l=new Promise((i,n)=>{B(l,i)})},t}var C=require("obsidian");var T="use.me",L="use.factory",k,x,I=function(){return Object.defineProperties(r(),{this:{get(){if(k)return k;throw new TypeError("No current context")}},me:{value:T},factory:{value:L}});function r(n){let e=new Map;e.prev=n;let s=Object.assign(n?o=>{let a=e.get(o);if(!a){for(let p=e.prev;p;p=p.prev)if(a=p.get(o)){a=Object.assign(Object.assign({},a),{s:a.s||1});break}a=a||{s:2,v:t},e.set(o,a)}let h,f,m;for(;;)switch(a.s){case 0:return k===s&&x&&x.push(o),a.v;case 1:if(h=a.d,!h||u(()=>h.k.every(p=>s(p)===h.c(p)))){a.s=0;break}a.v=h.f;case 2:a.s=4;try{l(e,o,0,u(f=a.v,o,m=[])),m.length&&(a.d={c:s,f,k:m});break}catch(p){a.s=3,a.v=p,a.d=null}case 3:throw a.v;case 4:throw new Error(`Factory ${String(a.v)} didn't resolve ${String(o)}`)}}:o=>I.this(o),{def(o,a){return l(e,o,2,a),s},set(o,a){return l(e,o,1,a),s},fork(o){let a=r(e);return o!=null?a(o):a}});return n?s.use=s:s;function u(o,a,h){let f=k,m=x;try{return k=s,x=h,o(a)}finally{k=f,x=m}}}function l(n,e,s,u){if(n.has(e)){let o=n.get(e);if(!o.s)throw new Error(`Already read: ${String(e)}`);o.s=s,o.v=u,o.d=null}else n.set(e,{s,v:u})}function t(n){if(typeof n[T]=="function")return n[T](n);if(i(n))return typeof n.prototype[L]=="function"?n.prototype[L]():new n;throw new ReferenceError(`No config for ${String(n)}`)}function i(n){return typeof n=="function"&&n.prototype!==void 0&&(Object.getPrototypeOf(n.prototype)!==Object.prototype||Object.getOwnPropertyNames(n.prototype).length>1||n.toString().startsWith("class"))}}();var z=(r=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(r,{get:(l,t)=>(typeof require!="undefined"?require:l)[t]}):r)(function(r){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var S=typeof queueMicrotask=="function"?queueMicrotask:(r=>l=>r.then(l))(Promise.resolve());var K=2,ht=4|K;function G(){let r,l,t=new Promise((i,n)=>{r=i,l=n});return{resolve:r,reject:l,promise:t}}function j(r,l,t,i,n){return r.on(l,t,i,n),()=>r.off(l,t,i,n)}var N;(r=>{try{Object.assign(r,z("obsidian"))}catch(l){}})(N||(N={}));var U;function M(r,l,t,i){let{resolve:n,promise:e}=G(),s=new class extends C.FuzzySuggestModal{getItemText(u){var o;return(o=l==null?void 0:l(u))!=null?o:""+u}getItems(){return r}onChooseItem(u,o){n({item:u,event:o})}onClose(){super.onClose(),S(()=>n({item:null,event:null}))}}(U);return t&&s.setPlaceholder(t),i==null||i(s),s.open(),e}function Y(r){return y.Keymap.compileModifiers(r.modifiers)+","+r.key.toLowerCase()}function X(r){return r==="plugins"||r==="community-plugins"}function V(){var r;return A()&&X((r=app.setting.activeTab)==null?void 0:r.id)}function A(){return app.setting.containerEl.parentElement!==null}function Q(r){return r instanceof y.Modal&&r.hasOwnProperty("autoload")&&typeof r.showPlugin=="function"&&typeof r.updateSearch=="function"&&typeof r.searchEl=="object"}function Z(r){var l;return r instanceof y.Modal&&typeof r.setAutoOpen=="function"&&typeof((l=r.search)==null?void 0:l.inputEl)=="object"}var P=class extends y.Plugin{constructor(){super(...arguments);this.lastSearch={};this.hotkeyButtons={};this.globalsAdded=!1;this.searchInput=null;this.commandsByPlugin={};this.assignedKeyCount={}}onload(){let t=this.app.workspace,i=this,n=t;this.registerEvent(n.on("plugin-settings:before-display",(u,o)=>{this.hotkeyButtons={},this.globalsAdded=!1,this.searchInput=null;let a=w(y.Setting.prototype,{addSearch(h){return function(f){return a(),h.call(this,m=>{i.searchInput=m,f==null||f(m)})}}});S(a)})),this.registerEvent(n.on("plugin-settings:after-display",()=>this.refreshButtons(!0))),this.registerEvent(n.on("plugin-settings:plugin-control",(u,o,a,h)=>{this.globalsAdded||this.addGlobals(h,u.settingEl)}));let e=(0,y.debounce)(this.refreshButtons.bind(this),50,!0);function s(u){return function(...o){return e(),u.apply(this,o)}}this.register(w(app.commands,{addCommand:s,removeCommand:s})),this.register(w(app.setting,{addSettingTab:s,removeSettingTab:s})),t.onLayoutReady(this.whenReady.bind(this)),this.registerObsidianProtocolHandler("goto-plugin",({id:u,show:o})=>{t.onLayoutReady(()=>{this.gotoPlugin(u,o)})})}whenReady(){var f,m;let t=this.app,i=this,n=(m=(f=t.internalPlugins.plugins["command-palette"])==null?void 0:f.instance)==null?void 0:m.modal;if(n){this.register(w(n,{onChooseItem(c){return function(g,E){return y.Keymap.isModEvent(E)?(S(()=>i.showHotkeysFor(g.name)),!1):c.call(this,g,E)}}}));let p=n.modalEl.find(".prompt-instructions .prompt-instruction");p&&createDiv("prompt-instruction",c=>{c.createSpan({cls:"prompt-instruction-command",text:y.Keymap.compileModifiers(["Mod"])+"+\u21B5"}),c.appendText(" "),c.createSpan({text:"to configure hotkey(s)"}),this.register(()=>c.detach())}).insertAfter(p)}let e=this.getSettingsTab("plugins"),s=this.getSettingsTab("community-plugins");e&&this.register(w(e,{display:this.addPluginSettingEvents.bind(this,e.id)})),s&&this.register(w(s,{display:this.addPluginSettingEvents.bind(this,s.id)}));let u=()=>this.enhanceViewer();s&&this.register(j(s.containerEl,"click",".mod-cta, .installed-plugins-container .setting-item-info",u,!0)),this.register(w(t.workspace.protocolHandlers,{get(p){return function(d){return d==="show-plugin"&&u(),p.call(this,d)}}}));function o(){V()&&t.setting.openTabById(t.setting.activeTab.id)}o(),this.register(()=>S(o));let a=this.getSettingsTab("hotkeys");a&&this.register(w(a,{display(p){return function(){var c,d;p.call(this),(d=(c=this.searchInputEl)!=null?c:this.searchComponent.inputEl)==null||d.focus()}},updateHotkeyVisibility(p){return function(){var E;let c=(E=this.searchInputEl)!=null?E:this.searchComponent.inputEl;if(!c)return p.call(this);let d=c.value,g=t.commands.commands;try{if(d.endsWith(":")&&!d.contains(" ")){let v=g,b=Object.fromEntries(Object.entries(t.commands.commands).filter(([_,et])=>(_+":").startsWith(d)));c.value="",t.commands.commands=new Proxy(g,{ownKeys(){try{return Object.keys(v)}finally{v=b}}})}return p.call(this)}finally{c.value=d,t.commands.commands=g}}}})),this.addCommand({id:"open-plugins",name:"Open the Community Plugins settings",callback:()=>this.showSettings("community-plugins")||!0}),this.addCommand({id:"browse-plugins",name:"Browse or search the Community Plugins catalog",callback:()=>this.gotoPlugin()});let h=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!0}).compare;this.addCommand({id:"open-settings",name:"Open settings for plugin...",callback:async()=>{let{item:p}=await M(t.setting.pluginTabs.concat(t.setting.settingTabs).sort((c,d)=>h(c.name,d.name)),c=>c.name,"Select a plugin to open its settings...");p&&(t.setting.open(),t.setting.openTabById(p.id))}}),this.addCommand({id:"open-hotkeys",name:"Open hotkeys for plugin...",callback:async()=>{var g,E;let p=this.refreshCommands(),c=Object.values(t.plugins.plugins).map(v=>v.manifest).concat(Object.entries(t.internalPlugins.plugins).map(([v,{instance:{name:b},_loaded:_}])=>({id:v,name:b,enabled:_})).filter(v=>v.enabled)).concat([{id:"app",name:"App"},{id:"editor",name:((g=this.getSettingsTab("editor"))==null?void 0:g.name)||"Editor"},{id:"workspace",name:((E=this.getSettingsTab("file"))==null?void 0:E.name)||"Files & Links"}]).filter(v=>{var b;return(b=p[v.id])==null?void 0:b.length}),{item:d}=await M(c.sort((v,b)=>h(v.name,b.name)),v=>v.name,"Select a plugin to open its hotkeys...");d&&this.showHotkeysFor(d.id+":")}})}createExtraButtons(t,i,n){i.id!=="app"&&t.addExtraButton(e=>{e.setIcon("gear"),e.onClick(()=>this.showConfigFor(i.id.replace(/^workspace$/,"file"))),e.setTooltip("Options"),e.extraSettingsEl.toggle(n)}),t.addExtraButton(e=>{e.setIcon("any-key"),e.onClick(()=>this.showHotkeysFor(i.id+":")),e.extraSettingsEl.toggle(n),this.hotkeyButtons[i.id]=e})}addGlobals(t,i){var o,a,h;this.globalsAdded=!0;let n=i.parentElement,e;if(t!=="plugins"||this.searchInput)(o=e=this.searchInput)==null||o.onChange(u);else{let f=new y.Setting(n).addSearch(m=>{e=m,m.setPlaceholder("Filter plugins...").onChange(u)});e.containerEl.style.margin="0",n.createDiv("hotkey-search-container").append(e.containerEl),f.settingEl.detach()}t==="community-plugins"&&e.inputEl.addEventListener("keydown",f=>{if(f.keyCode===13&&!y.Keymap.getModifiers(f))return this.gotoPlugin(),!1});let s=this;function u(f){let m=(s.lastSearch[t]=f).toLowerCase();function p(c){if(!c)return!1;let d=c.textContent=c.textContent,g=d.toLowerCase().indexOf(m);return~g?(c.textContent=d.substr(0,g),c.createSpan("suggestion-highlight").textContent=d.substr(g,m.length),c.insertAdjacentText("beforeend",d.substr(g+m.length)),!0):!1}n.findAll(".setting-item").forEach(c=>{var v;let d=p(c.find(".setting-item-name")),g=p((v=c.find(".setting-item-description > div:last-child:not(.plugin-comment)"))!=null?v:c.find(".setting-item-description > div:nth-child(3):not(.plugin-comment)")),E=p(c.find(".setting-item-description > div:nth-child(2)"));c.toggle(d||g||E)})}if(S(()=>{e&&(e&&typeof s.lastSearch[t]=="string"&&(e.setValue(s.lastSearch[t]),e.onChanged()),y.Platform.isMobile||e.inputEl.select())}),n.append(i),t==="plugins"){let f=((a=this.getSettingsTab("editor"))==null?void 0:a.name)||"Editor",m=((h=this.getSettingsTab("file"))==null?void 0:h.name)||"Files & Links";this.createExtraButtons(new y.Setting(i.parentElement).setName("App").setDesc("Miscellaneous application commands (always enabled)"),{id:"app",name:"App"},!0),this.createExtraButtons(new y.Setting(i.parentElement).setName(f).setDesc("Core editing commands (always enabled)"),{id:"editor",name:f},!0),this.createExtraButtons(new y.Setting(i.parentElement).setName(m).setDesc("Core file and pane management commands (always enabled)"),{id:"workspace",name:m},!0),i.parentElement.append(i)}}enhanceViewer(){let t=this;setTimeout(w(y.Modal.prototype,{open(i){return function(...n){return Z(this)&&(S(()=>{t.lastSearch["community-plugins"]&&(this.search.inputEl.value=t.lastSearch["community-plugins"],this.search.inputEl.dispatchEvent(new Event("input")))}),t.currentViewer=this,w(this,{close(e){return function(...s){return t.currentViewer=null,e.apply(this,s)}},showItem(e){return async function(s){let u=await e.call(this,s);if(t.app.plugins.plugins[s.id]){let o=i18next.t("setting.hotkeys.name"),a=this.detailsEl.find("button").parentElement;for(let h of a.findAll("button"))h.textContent===o&&(t.hotkeyButtons[s.id]={setTooltip(f){return h.title=f,this},extraSettingsEl:h});t.refreshButtons(!0)}return u}}})),Q(this)&&(S(()=>{if(t.lastSearch["community-plugins"]){let e=this.searchResultEl.cloneNode();this.searchContainerEl.replaceChild(e,this.searchResultEl),this.searchResultEl=e,this.searchEl.value=t.lastSearch["community-plugins"],this.searchEl.dispatchEvent(new Event("input"))}this.searchEl.select()}),t.currentViewer=this,w(this,{updateSearch:R,close(e){return function(...s){return t.currentViewer=null,e.apply(this,s)}},showPlugin(e){return async function(s){let u=await e.call(this,s);if(t.app.plugins.plugins[s.id]){let o=i18next.t("setting.hotkeys.name"),a=this.pluginContentEl.find("button").parentElement;for(let h of a.findAll("button"))h.textContent===o&&(t.hotkeyButtons[s.id]={setTooltip(f){return h.title=f,this},extraSettingsEl:h});t.refreshButtons(!0)}return u}}})),i.apply(this,n)}}}),0)}getSettingsTab(t){return app.setting.settingTabs.filter(i=>i.id===t).shift()}addPluginSettingEvents(t,i){let n=this.app,e=this,s=!1;function u(o,...a){s=!0;try{n.workspace.trigger(o,...a)}catch(h){console.error(h)}s=!1}return function(...a){if(s)return;u("plugin-settings:before-display",this,t);let h;t==="plugins"?h=Object.entries(n.internalPlugins.plugins).map(([c,{instance:{name:d,hiddenFromList:g},_loaded:E}])=>!g&&{id:c,name:d,enabled:E}).filter(c=>c):h=Object.values(n.plugins.manifests),h.sort((c,d)=>c.name.localeCompare(d.name));let f=0,m="",p=w(y.Setting.prototype,{addExtraButton(c){return function(d){if(!s&&(t==="plugins"||this.descEl.childElementCount)&&(h[f]||{}).name===this.nameEl.textContent){let g=h[f++];m=g.id,u("plugin-settings:plugin-control",this,g,g.enabled,t)}return c.call(this,function(g){d(g),!s&&g.extraSettingsEl.find("svg.any-key, svg.lucide-plus-circle")&&m&&(e.hotkeyButtons[m]=g,g.onClick(e.showHotkeysFor.bind(e,m+":")))})}}});try{return i.apply(this,a)}finally{p(),u("plugin-settings:after-display",this)}}}gotoPlugin(t,i="info"){if(t&&i==="hotkeys")return this.showHotkeysFor(t+":");if(t&&i==="config"){this.showConfigFor(t)||this.app.setting.close();return}this.showSettings("community-plugins");let n=w(y.Modal.prototype,{open(e){return function(...s){var u;return n(),t&&(this.autoload=t,(u=this.setAutoOpen)==null||u.call(this,t)),e.apply(this,s)}}});this.app.setting.activeTab.containerEl.find(".mod-cta").click()}showSettings(t){var i,n,e;if((i=this.currentViewer)==null||i.close(),A()||app.setting.open(),t)return((n=app.setting.activeTab)==null?void 0:n.id)!==t&&app.setting.openTabById(t),((e=app.setting.activeTab)==null?void 0:e.id)===t?app.setting.activeTab:!1}showHotkeysFor(t){var n,e;let i=this.showSettings("hotkeys");i&&((n=i.searchInputEl)!=null?n:i.searchComponent.inputEl)&&i.updateHotkeyVisibility&&(((e=i.searchInputEl)!=null?e:i.searchComponent.inputEl).value=t,i.updateHotkeyVisibility())}showConfigFor(t){return this.showSettings(t)?!0:(new y.Notice(`No settings tab for "${t}": it may not be installed or might not have settings.`),!1)}pluginEnabled(t){var i;return((i=app.internalPlugins.plugins[t])==null?void 0:i._loaded)||app.plugins.plugins[t]}refreshCommands(){let t=app.hotkeyManager;return this.assignedKeyCount={},this.commandsByPlugin=Object.values(app.commands.commands).reduce((i,n)=>{let e=n.id.split(":",2).shift(),s=(t.getHotkeys(n.id)||t.getDefaultHotkeys(n.id)||[]).map(Y);return s.forEach(u=>this.assignedKeyCount[u]=1+(this.assignedKeyCount[u]||0)),(i[e]||(i[e]=[])).push({hotkeys:s,cmd:n}),i},{})}refreshButtons(t=!1){var n;if(!V()&&!t)return;this.refreshCommands();let i=Object.values(app.setting.pluginTabs).reduce((e,s)=>(e[s.id]=s,e),{});i.workspace=i.editor=!0;for(let e of Object.keys(this.hotkeyButtons||{})){let s=this.hotkeyButtons[e];if(!this.commandsByPlugin[e]||((n=app.internalPlugins.plugins[e])==null?void 0:n.enabled)===!1){s.extraSettingsEl.hide();continue}let u=this.commandsByPlugin[e].filter(a=>a.hotkeys.length),o=u.filter(a=>a.hotkeys.filter(h=>this.assignedKeyCount[h]>1).length).length;s.setTooltip(`Configure hotkeys
(${u.length}/${this.commandsByPlugin[e].length} assigned${o?"; "+o+" conflicting":""})`),s.extraSettingsEl.toggleClass("mod-error",!!o),s.extraSettingsEl.show()}}};
