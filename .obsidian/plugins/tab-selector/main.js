/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var V=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var se=(h,c)=>{for(var e in c)V(h,e,{get:c[e],enumerable:!0})},oe=(h,c,e,o)=>{if(c&&typeof c=="object"||typeof c=="function")for(let t of ee(c))!te.call(h,t)&&t!==e&&V(h,t,{get:()=>c[t],enumerable:!(o=Z(c,t))||o.enumerable});return h};var ie=h=>oe(V({},"__esModule",{value:!0}),h);var pe={};se(pe,{default:()=>F});module.exports=ie(pe);var K=require("obsidian");var l=require("obsidian");var R=require("obsidian");var E=class extends Error{constructor(c,e){super(c),Error.captureStackTrace&&Error.captureStackTrace(this,E),this.name="KeySettingsError",console.warn(e)}};var z="tab-selector-styles",L={notOnlyOneHotkey:"Not only one hotkey.",mismatchMainModifierKey:"Mismatch main modifier key.",mismatchActionKey:"Mismatch action key.",mismatchSubModifierKey:"Mismatch sub modifier key.",useDuplicateModifierKey:"Use duplicate modifier key.",useDuplicateActionKey:"Use duplicate action key."},N=(h,c,e=!0)=>{var p;let o=(p=h.hotkeyManager)==null?void 0:p.customKeys,t=o&&o["tab-selector:go-to-previous-tab"]||[],s=o&&o["tab-selector:go-to-next-tab"]||[],i={settings:c,toPrevHotkeys:t,toNextHotkeys:s};if(!t[0]||!s[0]||t.length>1||s.length>1){if(e)throw new E(`Invalid settings: ${L.notOnlyOneHotkey}`,i);return!1}let a=t[0],r=s[0],{mainModifierKey:n,subModifierKey:u,actionKey:d,reverseActionKey:g,howToNextTab:y}=c,w=y===v.useSubModifierKey,f="";if(G(a.modifiers[0])!==n&&(f=f||L.mismatchMainModifierKey),w?((a.key!==d||r.key!==d)&&(f=f||L.mismatchActionKey),r.modifiers.filter(P=>G(P)===u).length!==1&&(f=f||L.mismatchSubModifierKey),n===u&&(f=f||L.useDuplicateModifierKey)):(a.key!==d||r.key!==g)&&(f=f||L.useDuplicateActionKey),f&&e)throw new E(`Invalid settings: ${f}`,i);return!f},G=h=>{switch(h){case"Mod":return R.Platform.isMacOS||R.Platform.isIosApp?m.meta:m.ctrl;case"Ctrl":return m.ctrl;case"Meta":case"Shift":case"Alt":default:return h}},j=()=>{let h=document.getElementById(z);h&&document.getElementsByTagName("HEAD")[0].removeChild(h)},U=h=>{let c=document.createElement("style");ae(c,{type:"text/css",id:z}),document.getElementsByTagName("HEAD")[0].appendChild(c),h.forEach(({selector:o,property:t,value:s})=>{ne(o,`${t}: ${s}`,c)})},ae=(h,c)=>{for(let e in c)h.setAttribute(e,c[e])},ne=(h,c,e)=>{e.textContent+=h+`{${c}}`};var m={ctrl:"Control",alt:"Alt",meta:"Meta",shift:"Shift"},A=l.Platform.isMacOS||l.Platform.isIosApp,k={ctrl:A?"^":"Ctrl",alt:A?"\u2325":"Alt",meta:A?"\u2318":"Win",shift:A?"\u21E7":"Shift"},T={tab:"Tab",arrowUp:"ArrowUp",arrowDown:"ArrowDown",arrowLeft:"ArrowLeft",arrowRight:"ArrowRight"},D={tab:"Tab",arrowUp:"\u2191",arrowDown:"\u2193",arrowLeft:"\u2190",arrowRight:"\u2192"},v={useSubModifierKey:"useSubModifierKey",useReverseActionKey:"useReverseActionKey"},re={useSubModifierKey:"Sub modifier key",useReverseActionKey:"Reverse action key"},S={goToPreviousNextTab:"goToPreviousNextTab",openTabSelector:"openTabSelector",showTabShortcuts:"showTabShortcuts",searchTab:"searchTab"},b={[S.goToPreviousNextTab]:{enableMultiWIndow:!1,focusColor:"#00b4e0",mainModifierKey:m.ctrl,subModifierKey:m.shift,actionKey:T.tab,reverseActionKey:T.arrowLeft,howToNextTab:v.useSubModifierKey},[S.openTabSelector]:{enableMultiWIndow:!1,showAliases:!1,replaceToAliases:!1,showPaths:!1,showPaginationButtons:!0,showLegends:!0,focusColor:"#00b4e0",characters:"asdfghjkl;",enableClose:!0},[S.showTabShortcuts]:{enableMultiWIndow:!1,characters:"asdfghjkl;qwertyuiopzxcvbnm,./"},[S.searchTab]:{enableMultiWIndow:!1,showAliases:!1,includeAliases:!1,showPaths:!1,includePaths:!1,showLegends:!0,focusColor:"#00b4e0"}},I={min:4,max:10},W=class extends l.PluginSettingTab{constructor(e,o){super(e,o);this.isOpen={firstDetails:!1,secondDetails:!1,thirdDetails:!1,fourthDetails:!1};this.plugin=o}display(){let{containerEl:e}=this;e.empty(),e.addClass("ts-settings");{let o=e.createEl("details","",t=>{t.createEl("summary","",s=>{s.setText('For "Go to previous/next tab" command')})});this.isOpen.firstDetails&&o.setAttr("open",!0),o.addEventListener("toggle",()=>this.isOpen.firstDetails=o.open),this.setForGoToPrevNextTabCommands(o)}{let o=e.createEl("details","",t=>{t.createEl("summary","",s=>{s.setText('For "Open tab selector" command')})});this.isOpen.secondDetails&&o.setAttr("open",!0),o.addEventListener("toggle",()=>this.isOpen.secondDetails=o.open),this.setForOpenTabSelectorCommand(o)}if(l.Platform.isDesktop||l.Platform.isTablet){let o=e.createEl("details","",t=>{t.createEl("summary","",s=>{s.setText('For "Show tab shortcuts" command')})});this.isOpen.thirdDetails&&o.setAttr("open",!0),o.addEventListener("toggle",()=>this.isOpen.thirdDetails=o.open),this.setForShowTabShortcutCommand(o)}{let o=e.createEl("details","",t=>{t.createEl("summary","",s=>{s.setText('For "Search tabs" command')})});this.isOpen.fourthDetails&&o.setAttr("open",!0),o.addEventListener("toggle",()=>this.isOpen.fourthDetails=o.open),this.setForSearchTabCommand(o)}}updateStyleSheet(e=!1){if(j(),e)return;let{goToPreviousNextTab:o,openTabSelector:t,searchTab:s}=this.plugin.settings,{showAliases:i,replaceToAliases:a,showPaths:r,focusColor:n,characters:u}=t,{focusColor:d}=o,{focusColor:g}=s,y=i&&!a?r?12:8:0,w=r?8:0,f=32+y+w;U([{selector:".ts-buttons-view",property:"min-height",value:`${f*u.length+8*(u.length-1)}px`},{selector:".ts-leaf-name-btn:focus",property:"outline",value:`2px solid ${n}`},{selector:".th-leaf-name-btn.is-focus",property:"outline",value:`2px solid ${d}`},{selector:".tab-search-modal .suggestion-item.is-selected",property:"outline",value:`2px solid ${g}`}])}setForGoToPrevNextTabCommands(e){let o=S.goToPreviousNextTab,t=this.plugin.settings[o];l.Platform.isDesktop&&new l.Setting(e).setName("Enable multiple window").setDesc("When enabled, all window's tabs is selectable. When disabled, only active window's tabs is selectable.").addToggle(s=>s.setValue(t.enableMultiWIndow).onChange(async i=>{t.enableMultiWIndow=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Color of button frame on focus").setDesc("Choose your favorite color.").addColorPicker(s=>s.setValue(t.focusColor).onChange(async i=>{t.focusColor=i,await this.plugin.saveData(this.plugin.settings),this.updateStyleSheet()})).then(s=>{let i=()=>t.focusColor=b[o].focusColor;this.addResetButton(s,i)}),new l.Setting(e).setName("Main modifier key").setDesc("Holding this key down keeps the modal open. When this key is released, it switches to the focused tab.").addDropdown(s=>s.addOptions(Object.keys(m).reduce((i,a)=>(i[a]=k[a],i),{})).setValue(this.convertToKey(t.mainModifierKey,m)).onChange(async i=>{t.mainModifierKey=this.convertToSettingValue(i,m,k),await this.plugin.saveData(this.plugin.settings),this.display()})).then(s=>{let i=()=>t.mainModifierKey=b[o].mainModifierKey;this.addResetButton(s,i)}),new l.Setting(e).setName("Action key").setDesc("Press this key while holding down the Main modifier key moves to the previous tab.").addDropdown(s=>s.addOptions(Object.keys(T).reduce((i,a)=>(i[a]=D[a],i),{})).setValue(this.convertToKey(t.actionKey,T)).onChange(async i=>{t.actionKey=this.convertToSettingValue(i,T,D),await this.plugin.saveData(this.plugin.settings),this.display()})).then(s=>{let i=()=>t.actionKey=b[o].actionKey;this.addResetButton(s,i)}),new l.Setting(e).setName("Choose how to go to the next tab").setDesc(`
				When go to the next tab, if you want to use the same key as the Action key, choose \u201CSub modifier key\u201D.
				If you want to use a different key from the Action key, choose \u201CReverse action key".
			`).addDropdown(s=>s.addOptions(Object.keys(v).reduce((i,a)=>(i[a]=re[a],i),{})).setValue(this.convertToKey(t.howToNextTab,v)).onChange(async i=>{t.howToNextTab=i,await this.plugin.saveData(this.plugin.settings),this.display()})).then(s=>{let i=()=>t.howToNextTab=b[o].howToNextTab;this.addResetButton(s,i)}),new l.Setting(e).setName("Sub modifier key").setDesc("Pressing the Action key while holding this key down moves to the next tab.").addDropdown(s=>s.addOptions(Object.keys(m).reduce((i,a)=>(i[a]=k[a],i),{})).setValue(this.convertToKey(t.subModifierKey,m)).onChange(async i=>{t.subModifierKey=this.convertToSettingValue(i,m,k),await this.plugin.saveData(this.plugin.settings),this.display()})).setDisabled(t.howToNextTab!==v.useSubModifierKey).then(s=>{if(t.howToNextTab===v.useSubModifierKey){let i=()=>t.subModifierKey=b[o].subModifierKey;this.addResetButton(s,i)}}),new l.Setting(e).setName("Reverse action key").setDesc("Press this key while holding down the Main modifier key moves to the next tab.").addDropdown(s=>s.addOptions(Object.keys(T).reduce((i,a)=>(i[a]=D[a],i),{})).setValue(this.convertToKey(t.reverseActionKey,T)).onChange(async i=>{t.reverseActionKey=this.convertToSettingValue(i,T,D),await this.plugin.saveData(this.plugin.settings),this.display()})).setDisabled(t.howToNextTab!==v.useReverseActionKey).then(s=>{if(t.howToNextTab===v.useSubModifierKey){let i=()=>t.reverseActionKey=b[o].reverseActionKey;this.addResetButton(s,i)}}),e.createDiv("th-how-to-use",s=>{s.createDiv("th-settings-description",p=>{p.createSpan("th-description-title").setText("How to use"),p.createSpan("").setText("1. Configure the above settings."),p.createSpan("").setText("2. Set the hotkeys to match for the following commands.")});let{mainModifierKey:i,subModifierKey:a,actionKey:r,reverseActionKey:n,howToNextTab:u}=t,d=this.convertToDisplayText(i,m,k),g=this.convertToDisplayText(a,m,k),y=this.convertToDisplayText(r,T,D),w=this.convertToDisplayText(n,T,D),f=u===v.useSubModifierKey;s.createDiv("th-hotkey-preview",p=>{p.createSpan("th-hotkey-preview-label").setText('"Tab Selector: Go to next tab": '),p.createSpan("th-hotkey-preview-value").setText((f?[d,g,y]:[d,w]).join(A?"":" + "))}),s.createDiv("th-hotkey-preview",p=>{p.createSpan("th-hotkey-preview-label").setText('"Tab Selector: Go to previous tab": '),p.createSpan("th-hotkey-preview-value").setText([d,y].join(A?"":" + "))}),s.createDiv("th-match-state",p=>{let P=N(this.app,t,!1);p.addClass(P?"is-match":"is-mismatch"),p.createSpan("th-match-icon",J=>(0,l.setIcon)(J,P?"check":"x")),p.createSpan("").setText(`Currently hotkeys ${P?"match":"mismatch"} the above commands.`)}),s.createDiv("th-settings-caution",p=>{p.createSpan("th-settings-caution-title").setText("Caution"),p.createSpan("").setText(`
					Don't use shortcut keys reserved by the OS.
					OS shortcut keys take precedence and don't work properly.
				`)})})}setForOpenTabSelectorCommand(e){let o=S.openTabSelector,t=this.plugin.settings[o];l.Platform.isDesktop&&new l.Setting(e).setName("Enable multiple window").setDesc("When enabled, all window's tabs is selectable. When disabled, only active window's tabs is selectable.").addToggle(s=>s.setValue(t.enableMultiWIndow).onChange(async i=>{t.enableMultiWIndow=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Show aliases").setDesc("When enabled, show file's aliases on button.").addToggle(s=>s.setValue(t.showAliases).onChange(async i=>{t.showAliases=i,t.replaceToAliases=!1,await this.plugin.saveData(this.plugin.settings),this.updateStyleSheet(),this.display()})),new l.Setting(e).setName("Replace the filename to aliases").setDesc("When enabled, if aliases is set the file, replace the filename to aliases.").addToggle(s=>s.setValue(t.replaceToAliases).onChange(async i=>{t.replaceToAliases=i,await this.plugin.saveData(this.plugin.settings),this.updateStyleSheet()})).setDisabled(!t.showAliases),new l.Setting(e).setName("Show paths").setDesc("When enabled, show file's paths on button.").addToggle(s=>s.setValue(t.showPaths).onChange(async i=>{t.showPaths=i,await this.plugin.saveData(this.plugin.settings),this.updateStyleSheet()})),new l.Setting(e).setName("Show pagination buttons").setDesc("When enabled, show pagination buttons on modal.").addToggle(s=>s.setValue(t.showPaginationButtons).onChange(async i=>{t.showPaginationButtons=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Show legends").setDesc("When enabled, show legends on modal.").addToggle(s=>s.setValue(t.showLegends).onChange(async i=>{t.showLegends=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Color of button frame on focus").setDesc("Choice your favorite color.").addColorPicker(s=>s.setValue(t.focusColor).onChange(async i=>{t.focusColor=i,await this.plugin.saveData(this.plugin.settings),this.updateStyleSheet()})).then(s=>{let i=()=>t.focusColor=b[o].focusColor;this.addResetButton(s,i)}),new l.Setting(e).setName("Characters used for button hints").setDesc(`Enter ${I.min}~${I.max} non-duplicate alphanumeric characters or symbols.`).addText(s=>{let i=t.characters,a=s.setPlaceholder("Enter characters").setValue(t.characters).onChange(async r=>{let{inputEl:n}=a;!this.isDuplicateChars([...r])&&n.validity.valid?(n.removeClass("ts-setting-is-invalid"),t.characters=r,i=r,await this.plugin.saveSettings()):n.addClass("ts-setting-is-invalid"),this.updateStyleSheet()});return a.inputEl.addEventListener("blur",()=>{(this.isDuplicateChars([...a.inputEl.value])||!a.inputEl.validity.valid)&&(t.characters=i)}),a.inputEl.setAttrs({maxLength:I.max,required:!0,pattern:`[!-~]{${I.min},${I.max}}`}),a}).then(s=>{let i=()=>t.characters=b[o].characters;this.addResetButton(s,i)}),new l.Setting(e).setName("Enable tabs close").setDesc("When enabled, the operation of closing tabs is enabled.").addToggle(s=>s.setValue(t.enableClose).onChange(async i=>{t.enableClose=i,await this.plugin.saveData(this.plugin.settings)}))}setForShowTabShortcutCommand(e){let o=S.showTabShortcuts,t=this.plugin.settings[o];l.Platform.isDesktop&&new l.Setting(e).setName("Enable multiple window").setDesc("When enabled, all window's tabs is selectable. When disabled, only active window's tabs is selectable.").addToggle(s=>s.setValue(t.enableMultiWIndow).onChange(async i=>{t.enableMultiWIndow=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Characters used for shortcut hints").setDesc("Enter non-duplicate alphanumeric characters or symbols.").addText(s=>{let i=t.characters,a=s.setPlaceholder("Enter characters").setValue(t.characters).onChange(async r=>{let{inputEl:n}=a;!this.isDuplicateChars([...r])&&n.validity.valid?(n.removeClass("ts-setting-is-invalid"),t.characters=r,i=r,await this.plugin.saveSettings()):n.addClass("ts-setting-is-invalid"),this.updateStyleSheet()});return a.inputEl.addEventListener("blur",()=>{(this.isDuplicateChars([...a.inputEl.value])||!a.inputEl.validity.valid)&&(t.characters=i)}),a.inputEl.setAttrs({required:!0,pattern:"[!-~]{1,}"}),a}).then(s=>{let i=()=>t.characters=b[o].characters;this.addResetButton(s,i)})}setForSearchTabCommand(e){let o=S.searchTab,t=this.plugin.settings[o];l.Platform.isDesktop&&new l.Setting(e).setName("Enable multiple window").setDesc("When enabled, all window's tabs is selectable. When disabled, only active window's tabs is selectable.").addToggle(s=>s.setValue(t.enableMultiWIndow).onChange(async i=>{t.enableMultiWIndow=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Show aliases").setDesc("When enabled, show file's aliases on list item.").addToggle(s=>s.setValue(t.showAliases).onChange(async i=>{t.showAliases=i,await this.plugin.saveData(this.plugin.settings),this.display()})),new l.Setting(e).setDisabled(!t.showAliases).setName("Include aliases in the search").setDesc('When enabled, include aliases in the search. This setting is valid when "Show aliases" is enabled.').addToggle(s=>s.setValue(t.includeAliases).onChange(async i=>{t.includeAliases=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Show paths").setDesc("When enabled, show file's paths on list item.").addToggle(s=>s.setValue(t.showPaths).onChange(async i=>{t.showPaths=i,await this.plugin.saveData(this.plugin.settings),this.display()})),new l.Setting(e).setDisabled(!t.showPaths).setName("Include paths in the search").setDesc('When enabled, include paths in the search. This setting is valid when "Show paths" is enabled.').addToggle(s=>s.setValue(t.includePaths).onChange(async i=>{t.includePaths=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Show legends").setDesc("When enabled, show legends on modal.").addToggle(s=>s.setValue(t.showLegends).onChange(async i=>{t.showLegends=i,await this.plugin.saveData(this.plugin.settings)})),new l.Setting(e).setName("Color of button frame on focus").setDesc("Choice your favorite color.").addColorPicker(s=>s.setValue(t.focusColor).onChange(async i=>{t.focusColor=i,await this.plugin.saveData(this.plugin.settings),this.updateStyleSheet()})).then(s=>{let i=()=>t.focusColor=b[o].focusColor;this.addResetButton(s,i)})}isDuplicateChars(e){return e.some((o,t)=>e.slice(t+1).includes(o))}convertToKey(e,o){let t=Object.entries(o).find(([,s])=>s===e);return t?t[0]:""}convertToSettingValue(e,o,t){let s=Object.keys(t).find(i=>i===e);return s?o[s]:""}convertToDisplayText(e,o,t){return t[this.convertToKey(e,o)]}addResetButton(e,o,t=!0){e.addExtraButton(s=>s.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{o(),await this.plugin.saveSettings(),this.updateStyleSheet(),t&&this.display()}))}};var C=require("obsidian"),X="ArrowUp",q="ArrowDown",Y="ArrowLeft",$="ArrowRight",le="Backspace",ce="Delete",he=[{keys:"\u2191 | \u2193",description:"Move focus"},{keys:"\u2190 | \u2192",description:"Switch pages"},{keys:"Enter | Space",description:"Switch to focused tab"},{keys:"BS | Delete",description:"Close focused tab"},{keys:"",description:"Quickly switch tab"},{keys:"",description:"Quickly close tab",modifier:!0}],O=class extends C.Modal{constructor(e,o,t){super(e);this.leaves=[];this.chars=[];this.leafButtonMap=new Map;this.closeButtonMap=new Map;this.focusPosition=0;this.pagePosition=0;this.settings=o,this.leaves=t.map(s=>{var u,d;s.name=s.getDisplayText();let i=((d=(u=s.view)==null?void 0:u.metadataEditor)==null?void 0:d.properties)||[];s.aliases=i.filter(g=>g.key==="aliases").flatMap(g=>g.value).filter(g=>g!=null);let{file:a}=s.getViewState().state,n=(typeof a=="string"?a.split(s.getDisplayText())[0]||"/":"-").split("/").map(g=>g.length>20?`${g.slice(0,20)}...`:g);return s.path=n.length>3?`.../${n.at(-3)}/${n.at(-2)}/`:n.join("/"),s}),this.chars=[...this.modalSettings.characters]}get currentLeaves(){return this.leaves.slice(0+this.pagePosition*this.chars.length,this.chars.length+this.pagePosition*this.chars.length)}get modalSettings(){return this.settings.openTabSelector}onOpen(){this.modalEl.addClasses(["tab-selector-modal","ts-modal"]),this.generateHeader(this.contentEl),this.buttonsViewEl=this.contentEl.createDiv("ts-buttons-view"),this.generateButtons(this.buttonsViewEl,this.currentLeaves),this.generateFooter(this.contentEl),this.eventListenerFunc=this.handlingKeyupEvent.bind(this),window.addEventListener("keyup",this.eventListenerFunc)}onClose(){window.removeEventListener("keyup",this.eventListenerFunc),this.contentEl.empty()}generateHeader(e){e.createDiv("ts-header",o=>{this.pageCounterEl=o.createSpan(""),this.updatePageCount(),o.createSpan("").setText("/"),o.createSpan("").setText(`${Math.ceil(this.leaves.length/this.chars.length)}`)})}generateButtons(e,o){var t;this.focusPosition=0,this.buttonsViewEl.empty(),o.forEach((s,i)=>{e.createDiv("ts-leaf-row",a=>{let r=a.createEl("button",{text:this.chars.at(i)});r.setAttr("tabIndex",-1),r.addClass("ts-shortcut-btn"),r.addEventListener("click",()=>this.clickLeafButton(s,r));let n=a.createEl("button");n.addClass("ts-leaf-name-btn"),n.addEventListener("click",()=>this.clickLeafButton(s,n));let u=n.createSpan("ts-leaf-name");if(u.setText(s.name||""),this.reflectOptions(s,a,n,u),this.leafButtonMap.set(s.id||"",n),this.modalSettings.enableClose){let d=a.createEl("button");(0,C.setIcon)(d,"x"),d.setAttr("tabIndex",-1),d.addClass("ts-close-btn"),d.addEventListener("click",()=>this.clickCloseLeafButton(s,a)),this.closeButtonMap.set(s.id||"",d),a.addClass("ts-leaf-row-deletable"),s.deleted&&a.addClass("deleted")}})}),this.leafButtonMap.get(((t=this.currentLeaves.at(0))==null?void 0:t.id)||"").focus(),this.updatePageCount()}reflectOptions(e,o,t,s){(this.modalSettings.showAliases&&!this.modalSettings.replaceToAliases||this.modalSettings.showPaths)&&o.addClass("ts-leaf-row-added-options"),this.modalSettings.showAliases&&(this.modalSettings.replaceToAliases?this.replaceLeafName(e.aliases||[],t,s):this.addAliasesEl(e.aliases||[],t)),this.modalSettings.showPaths&&this.addPathEl(e,t)}replaceLeafName(e,o,t){if(e.length){t.detach();let s=o.createDiv("ts-option-wrapper");(0,C.setIcon)(s,"corner-up-right"),s.createSpan("ts-leaf-alias").setText(e.join(" | "))}}addAliasesEl(e,o){let t=o.createDiv("ts-option-wrapper");(0,C.setIcon)(t,"corner-up-right"),t.createEl("small").setText(e.join(" | "))}addPathEl(e,o){let t=o.createDiv("ts-option-wrapper");(0,C.setIcon)(t,"folder-closed"),t.createEl("small").setText(e.path||"")}generateFooter(e){e.createDiv("ts-footer",o=>{this.modalSettings.showPaginationButtons&&this.leaves.length>this.chars.length&&o.createDiv("ts-page-nav",t=>{let s=t.createEl("button",{text:"\u2190"});s.setAttr("tabIndex",-1),s.addClass("ts-nav-btn"),s.addEventListener("click",()=>this.keyupArrowKeys(Y));let i=t.createEl("button",{text:"\u2192"});i.setAttr("tabIndex",-1),i.addClass("ts-nav-btn"),i.addEventListener("click",()=>this.keyupArrowKeys($))}),this.modalSettings.showLegends&&he.forEach(t=>{t.modifier&&!this.modalSettings.enableClose||o.createDiv("ts-legends",s=>{let i=t.keys||(t.modifier?`Ctrl + ${this.chars.slice(0,2).join(" | ")} | ... | ${this.chars.slice(-2).join(" | ")}`:`${this.chars.slice(0,2).join(" | ")} | ... | ${this.chars.slice(-2).join(" | ")}`);s.createSpan("ts-keys").setText(i),s.createSpan("ts-description").setText(t.description)})})})}updatePageCount(){this.pageCounterEl.setText(`${this.pagePosition+1}`)}clickLeafButton(e,o){o.classList.contains("deleted")||(this.close(),this.app.workspace.setActiveLeaf(e,{focus:!0}))}clickCloseLeafButton(e,o){if(e.deleted)return;o.addClass("deleted"),e.deleted=!0,e.detach();let t=this.currentLeaves.findIndex(({id:s})=>s===e.id);this.focusPosition=t>=0?t:0,this.leafButtonMap.get((e==null?void 0:e.id)||"").focus()}handlingKeyupEvent(e){if(this.chars.includes(e.key)){this.keyupShortcutKeys(e.key,e.ctrlKey),e.preventDefault();return}if([le,ce].includes(e.key)){this.keyUpCloseKeys(),e.preventDefault();return}if([X,q,Y,$].includes(e.key)){this.keyupArrowKeys(e.key),e.preventDefault();return}}keyupShortcutKeys(e,o){var s,i;let t=this.chars.indexOf(e);o?this.keyUpCloseKeys(t):(i=this.leafButtonMap.get(((s=this.currentLeaves.at(t))==null?void 0:s.id)||""))==null||i.click()}keyUpCloseKeys(e){var t,s;if(e==null&&!this.leaves.some(i=>this.leafButtonMap.get(i.id||"")===document.activeElement))return;let o=e!=null?e:this.focusPosition;(s=this.closeButtonMap.get(((t=this.currentLeaves.at(o))==null?void 0:t.id)||""))==null||s.click()}keyupArrowKeys(e){var o,t;switch(e){case X:this.focusPosition===0?(this.leafButtonMap.get(((o=this.currentLeaves.at(-1))==null?void 0:o.id)||"").focus(),this.focusPosition=this.currentLeaves.length-1):(this.leafButtonMap.get(this.currentLeaves[this.focusPosition-1].id||"").focus(),this.focusPosition-=1);break;case q:this.focusPosition===this.currentLeaves.length-1?(this.leafButtonMap.get(((t=this.currentLeaves.at(0))==null?void 0:t.id)||"").focus(),this.focusPosition=0):(this.leafButtonMap.get(this.currentLeaves[this.focusPosition+1].id||"").focus(),this.focusPosition+=1);break;case Y:{let s=this.leaves.length/this.chars.length;if(Math.ceil(s)===1)break;this.pagePosition===0?this.pagePosition=this.leaves.length%this.chars.length===0?Math.floor(s)-1:Math.floor(s):this.pagePosition-=1,this.generateButtons(this.buttonsViewEl,this.currentLeaves);break}case $:{let s=this.leaves.length/this.chars.length;if(Math.ceil(s)===1)break;let i=this.leaves.length%this.chars.length===0?s-1:Math.floor(s);this.pagePosition===i?this.pagePosition=0:this.pagePosition+=1,this.generateButtons(this.buttonsViewEl,this.currentLeaves);break}default:break}}};var x=require("obsidian");var de=(h,c)=>h.activeTime==null||c.activeTime==null?0:h.activeTime>c.activeTime?-1:1,B=class extends x.Modal{constructor(e,o,t,s){super(e);this.leaves=[];this.leafButtonMap=new Map;this.closeButtonMap=new Map;this.focusPosition=0;this.isEnabled=!1;this.isPrevCommand=!0;this.eventListenerFunc={keydown:()=>{},keyup:()=>{}};this.settings=o;try{this.isEnabled=N(e,this.modalSettings)}catch(i){console.error(i)}this.isPrevCommand=s,this.leaves=t.map(i=>(i.name=i.getDisplayText(),i)).sort(de),this.eventListenerFunc.keydown=this.keydown.bind(this),window.addEventListener("keydown",this.eventListenerFunc.keydown),this.eventListenerFunc.keyup=this.keyup.bind(this),window.addEventListener("keyup",this.eventListenerFunc.keyup)}get modalSettings(){return this.settings.goToPreviousNextTab}onOpen(){if(!this.isEnabled){new x.Notice('"Tab Selector" plugin has incorrect settings. Please review the [For "Go to previous/next tab" command] settings.',0),this.close();return}this.modalEl.addClasses(["tab-history-modal","th-modal"]);let e=this.contentEl.createDiv("th-leaves");this.generateButtons(e,this.leaves),this.isPrevCommand?this.focusToPreviousTab():this.focusToNextTab()}onClose(){window.removeEventListener("keydown",this.eventListenerFunc.keydown),window.removeEventListener("keyup",this.eventListenerFunc.keyup),this.contentEl.empty()}generateButtons(e,o){o.forEach(t=>{e.createDiv("th-leaf-row",s=>{let i=s.createEl("button");i.addClass("th-leaf-name-btn"),i.addEventListener("mouseup",n=>(n.preventDefault(),this.switchToFocusedTab(t))),i.addEventListener("touchend",n=>(n.preventDefault(),this.switchToFocusedTab(t))),i.createSpan("th-leaf-name").setText(t.name||""),this.leafButtonMap.set(t.id||"",i);let r=i.createEl("button");(0,x.setIcon)(r,"x"),r.setAttr("tabIndex",-1),r.addClass("th-close-btn"),r.addEventListener("mouseup",n=>(n.stopPropagation(),this.clickCloseLeafButton(t,s))),r.addEventListener("touchend",n=>(n.stopPropagation(),this.clickCloseLeafButton(t,s))),this.closeButtonMap.set(t.id||"",r)})})}keydown(e){this.moveFocus(e)}keyup(e){if(e.key===this.modalSettings.mainModifierKey){let o=this.leaves[this.focusPosition];this.switchToFocusedTab(o)}}moveFocus(e){this.modalSettings.howToNextTab===v.useSubModifierKey&&e.key===this.modalSettings.actionKey&&(this.isHoldDownSubModifierKey(e,this.modalSettings.subModifierKey)?this.focusToNextTab():this.focusToPreviousTab()),this.modalSettings.howToNextTab===v.useReverseActionKey&&(e.key===this.modalSettings.reverseActionKey&&this.focusToNextTab(),e.key===this.modalSettings.actionKey&&this.focusToPreviousTab())}isHoldDownSubModifierKey(e,o){switch(o){case m.ctrl:return e.ctrlKey;case m.alt:return e.altKey;case m.meta:return e.metaKey;case m.shift:return e.shiftKey;default:return!1}}focusToNextTab(){var e;this.focusPosition===0?(this.leafButtonMap.get(((e=this.leaves.at(-1))==null?void 0:e.id)||"").focus(),this.focusPosition=this.leaves.length-1):(this.leafButtonMap.get(this.leaves[this.focusPosition-1].id||"").focus(),this.focusPosition-=1),this.addMarkOfFocus()}focusToPreviousTab(){var e;this.focusPosition===this.leaves.length-1?(this.leafButtonMap.get(((e=this.leaves.at(0))==null?void 0:e.id)||"").focus(),this.focusPosition=0):(this.leafButtonMap.get(this.leaves[this.focusPosition+1].id||"").focus(),this.focusPosition+=1),this.addMarkOfFocus()}addMarkOfFocus(){var o;this.leafButtonMap.forEach(t=>t.removeClass("is-focus")),this.leafButtonMap.get(((o=this.leaves[this.focusPosition])==null?void 0:o.id)||"").addClass("is-focus")}switchToFocusedTab(e){this.app.workspace.setActiveLeaf(e,{focus:!0}),this.close()}clickCloseLeafButton(e,o){let t=this.leaves.findIndex(({id:s})=>s===e.id);if(this.focusPosition=t<this.focusPosition?this.focusPosition-1:this.focusPosition,this.leafButtonMap.delete(e.id||""),this.leaves=this.leaves.filter(({id:s})=>s!==e.id),o.remove(),e.detach(),this.addMarkOfFocus(),!this.leaves.length){this.close();return}setTimeout(()=>{let s=this.leaves[this.focusPosition];this.leafButtonMap.get((s==null?void 0:s.id)||"").focus()},1)}};var Q=require("obsidian"),_=class extends Q.Modal{constructor(e,o,t){super(e);this.leaves=[];this.chars=[];this.tabHeaderContainers=[];this.windows=[];this.labelContainerMap=new Map;this.eventListenerFunc={keyup:()=>{},resize:()=>{},click:()=>{}};this.settings=o,this.chars=[...this.modalSettings.characters],this.leaves=t.map((s,i)=>(s.name=i<this.chars.length?this.chars[i]:"",s))}get modalSettings(){return this.settings.showTabShortcuts}onOpen(){this.modalEl.addClasses(["tab-shortcuts-modal","tsh-modal"]),this.eventListenerFunc.click=this.handlingClickEvent.bind(this),this.eventListenerFunc.keyup=this.handlingKeyupEvent.bind(this),this.eventListenerFunc.resize=this.handlingResizeEvent.bind(this),window.addEventListener("keyup",this.eventListenerFunc.keyup),window.addEventListener("resize",this.eventListenerFunc.resize),this.windows=this.generateWindows(this.leaves),this.showShortcutElements(this.windows),this.tabHeaderContainers.forEach(e=>e==null?void 0:e.addClass("tsh-header-container-inner"))}onClose(){this.windows.forEach(({window:e})=>e.removeEventListener("click",this.eventListenerFunc.click)),window.removeEventListener("keyup",this.eventListenerFunc.keyup),window.removeEventListener("resize",this.eventListenerFunc.resize),this.tabHeaderContainers.forEach(e=>e==null?void 0:e.removeClass("tsh-header-container-inner")),this.labelContainerMap.forEach(e=>e.remove()),this.contentEl.empty()}generateWindows(e){return e.reduce((o,t)=>{var i,a,r;let s=o.find(n=>{var u;return n.id===((u=t.parent)==null?void 0:u.id)||""});if(s)return s.leaves=[...s.leaves,t],o;{let n=(a=(i=t.containerEl)==null?void 0:i.ownerDocument.defaultView)!=null?a:window;return n.addEventListener("click",this.eventListenerFunc.click),[...o,{id:((r=t.parent)==null?void 0:r.id)||"",window:n,leaves:[t]}]}},[])}showShortcutElements(e){e.forEach(o=>{var a,r,n;let t=(n=(r=(a=o.leaves[0])==null?void 0:a.containerEl)==null?void 0:r.parentElement)==null?void 0:n.parentElement;this.tabHeaderContainers.push(t==null?void 0:t.querySelector(".workspace-tab-header-container-inner"));let s=t==null?void 0:t.querySelectorAll(".workspace-tab-header-container-inner .workspace-tab-header");if(!s)return;let i=createDiv("tab-shortcuts-container");o.window.document.body.append(i),this.labelContainerMap.set(o.id,i),o.leaves.forEach((u,d)=>{if(!this.chars.length)return;let g=s[d].getBoundingClientRect();createDiv("tsh-label",y=>{var w;y.setText(u.name||""),y.setCssProps({top:`${g.bottom}px`,left:`calc(${g.left}px + 0.5rem)`}),(w=this.labelContainerMap.get(o.id))==null||w.appendChild(y)})})})}handlingClickEvent(){this.close()}handlingKeyupEvent(e){if(this.chars.includes(e.key)){this.close();let o=this.leaves.find(t=>t.name===e.key);o&&this.app.workspace.setActiveLeaf(o,{focus:!0}),e.preventDefault();return}}handlingResizeEvent(){this.close()}};var M=require("obsidian"),ue=[{keys:"\u2191 | \u2193",description:"Move focus"},{keys:"Enter",description:"Switch to focused tab"}],H=class extends M.FuzzySuggestModal{constructor(e,o,t){super(e);this.leaves=[];this.settings=o,this.leaves=t.map(s=>{var n,u;s.name=s.getDisplayText();let i=((u=(n=s.view)==null?void 0:n.metadataEditor)==null?void 0:u.properties)||[];s.aliases=i.filter(d=>d.key==="aliases").flatMap(d=>d.value).filter(d=>d!=null);let{file:a}=s.getViewState().state,r=typeof a=="string"?a.split(s.getDisplayText())[0]||"/":"-";return s.path=r,s}),this.setPlaceholder("Search tabs"),this.modalEl.addClasses(["tab-search-modal","tse-modal"]),this.modalSettings.showLegends&&this.generateFooter(this.modalEl)}get modalSettings(){return this.settings.searchTab}getItems(){return this.leaves}getItemText(e){return e.name||""}getSuggestions(e){return this.getItems().filter(o=>this.getReferenceStrings(o).some(t=>(0,M.prepareFuzzySearch)(e)(t))).map(o=>({item:o,match:{score:0,matches:[]}}))}onChooseItem(e){this.app.workspace.setActiveLeaf(e,{focus:!0})}renderSuggestion(e,o){return o.createDiv("tse-item-row",t=>{t.setText(e.item.name||"")}),this.modalSettings.showAliases&&o.createDiv("tse-item-row",t=>{var s;(0,M.setIcon)(t,"corner-up-right"),t.createEl("small").setText(((s=e.item.aliases)==null?void 0:s.join(" | "))||"")}),this.modalSettings.showPaths&&o.createDiv("tse-item-row",t=>{(0,M.setIcon)(t,"folder-closed"),t.createEl("small").setText(e.item.path||"")}),o}getReferenceStrings(e){var p;let o=e.name||"",{showAliases:t,includeAliases:s,showPaths:i,includePaths:a}=this.modalSettings,r=t&&s&&((p=e.aliases)==null?void 0:p.join(" "))||"",n=i&&a?e.path:"",u=`${o} ${r} ${n}`,d=`${o} ${n} ${r}`,g=`${r} ${o} ${n}`,y=`${r} ${n} ${o}`,w=`${n} ${o} ${r}`,f=`${n} ${r} ${o}`;return[u,d,g,y,w,f]}generateFooter(e){e.createDiv("tse-footer",o=>{ue.forEach(t=>{o.createDiv("tse-legends",s=>{s.createSpan("tse-keys").setText(t.keys),s.createSpan("tse-description").setText(t.description)})})})}};var F=class extends K.Plugin{async onload(){await this.loadSettings(),this.addRibbonIcon("file-check-2","Open tab selector",()=>this.openTabSelectorModal()),this.addCommand({id:"open-tab-selector",name:"Open tab selector",callback:()=>this.openTabSelectorModal()}),this.addCommand({id:"go-to-previous-tab",name:"Go to previous tab",callback:()=>this.openTabHistoryModal(!0)}),this.addCommand({id:"go-to-next-tab",name:"Go to next tab",callback:()=>this.openTabHistoryModal(!1)}),(K.Platform.isDesktop||K.Platform.isTablet)&&this.addCommand({id:"show-tab-shortcuts",name:"Show tab shortcuts",callback:()=>this.showTabShortcutsModal()}),this.addCommand({id:"search-tabs",name:"Search tabs",callback:()=>this.openTabSearchModal()}),this.settingTab=new W(this.app,this),this.addSettingTab(this.settingTab),this.settingTab.updateStyleSheet()}onunload(){this.settingTab.updateStyleSheet(!0)}async loadSettings(){this.settings=Object.assign({},b,await this.loadData()),this.migrateSettingValues()}async saveSettings(){await this.saveData(this.settings)}openTabSelectorModal(){let e=this.settings.openTabSelector.enableMultiWIndow,o=this.generateLeaves(e);new O(this.app,this.settings,o).open()}openTabHistoryModal(e){let o=this.settings.goToPreviousNextTab.enableMultiWIndow,t=this.generateLeaves(o);new B(this.app,this.settings,t,e).open()}showTabShortcutsModal(){let e=this.settings.showTabShortcuts.enableMultiWIndow,o=this.generateLeaves(e);new _(this.app,this.settings,o).open()}openTabSearchModal(){let e=this.settings.searchTab.enableMultiWIndow,o=this.generateLeaves(e);new H(this.app,this.settings,o).open()}generateLeaves(e){var s;let o=[];this.app.workspace.iterateRootLeaves(i=>{o.push((i==null?void 0:i.id)||"")});let t=[];if(K.Platform.isDesktop&&e)this.app.workspace.iterateAllLeaves(i=>{i.getRoot().containerEl.hasClass("mod-sidedock")||t.push(i)});else{let{id:i,type:a}=(s=this.app.workspace.getMostRecentLeaf())==null?void 0:s.getRoot();this.app.workspace.iterateAllLeaves(r=>{i===r.getRoot().id&&(r.id&&o.includes(r.id)||a==="floating")&&t.push(r)})}return t}async migrateSettingValues(){let e=this.settings;{let o=this.settings.openTabSelector;typeof e.showAliases=="boolean"&&(o.showAliases=e.showAliases,delete e.showAliases),typeof e.replaceToAliases=="boolean"&&(o.replaceToAliases=e.replaceToAliases,delete e.replaceToAliases),typeof e.showPaths=="boolean"&&(o.showPaths=e.showPaths,delete e.showPaths),typeof e.showPaginationButtons=="boolean"&&(o.showPaginationButtons=e.showPaginationButtons,delete e.showPaginationButtons),typeof e.showLegends=="boolean"&&(o.showLegends=e.showLegends,delete e.showLegends),typeof e.focusColor=="string"&&(o.focusColor=e.focusColor,delete e.focusColor),typeof e.characters=="string"&&(o.characters=e.characters,delete e.characters),typeof e.enableClose=="boolean"&&(o.enableClose=e.enableClose,delete e.enableClose)}{let o=this.settings.goToPreviousNextTab;typeof e.thFocusColor=="string"&&(o.focusColor=e.thFocusColor,delete e.thFocusColor),typeof e.mainModifierKey=="string"&&(o.mainModifierKey=e.mainModifierKey,delete e.mainModifierKey),typeof e.subModifierKey=="string"&&(o.subModifierKey=e.subModifierKey,delete e.subModifierKey),typeof e.actionKey=="string"&&(o.actionKey=e.actionKey,delete e.actionKey),typeof e.howToNextTab=="string"&&(o.howToNextTab=e.howToNextTab,delete e.howToNextTab),typeof e.reverseActionKey=="string"&&(o.reverseActionKey=e.reverseActionKey,delete e.reverseActionKey)}{let o=this.settings.showTabShortcuts;typeof e.tshCharacters=="string"&&(o.characters=e.tshCharacters,delete e.tshCharacters)}typeof e.backActionKey=="string"&&delete e.backActionKey,typeof e.howToPreviousTab=="string"&&delete e.howToPreviousTab,typeof e.showPaginationButton=="boolean"&&delete e.showPaginationButton,typeof e.showLegend=="boolean"&&delete e.showLegend,await this.saveSettings()}};
